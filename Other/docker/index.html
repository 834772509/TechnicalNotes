<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>概述 | 杉-技术笔记</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/TechnicalNotes/img/LOGO.ico">
    <meta name="description" content="记录工作和学习过程中的笔记">
    
    <link rel="preload" href="/TechnicalNotes/assets/css/0.styles.a649f350.css" as="style"><link rel="preload" href="/TechnicalNotes/assets/js/app.c00b0a4a.js" as="script"><link rel="preload" href="/TechnicalNotes/assets/js/3.ede93df9.js" as="script"><link rel="preload" href="/TechnicalNotes/assets/js/4.d93f2a77.js" as="script"><link rel="preload" href="/TechnicalNotes/assets/js/15.024d8240.js" as="script"><link rel="prefetch" href="/TechnicalNotes/assets/js/10.f267382b.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/100.03614d69.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/101.17e82d68.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/102.215a52d2.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/103.4b5d99d7.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/104.287c3211.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/105.8479e2f2.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/106.c6d1ce9d.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/107.3b6b63cc.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/108.2ff55248.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/109.a70b74e8.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/11.d8ab907c.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/110.626e342b.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/111.53ebe5b2.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/112.841746b1.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/113.6e7ffde1.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/114.f60417ff.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/115.2216fbda.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/116.8316eaa0.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/117.4907f628.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/118.746fb9c8.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/119.62261e49.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/12.d917524c.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/120.03504d08.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/121.332c6c04.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/122.e32b03a0.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/123.aaae6ac9.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/124.191318ae.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/125.c61ec3fc.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/126.33b25865.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/127.d5822055.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/128.a49f9900.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/129.0fd6db1f.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/13.2e7e2bd0.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/130.c9cdcb3e.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/131.9a7431e8.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/132.1f3a67d9.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/133.f9dd4c5f.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/134.f7225234.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/135.e0c1c3c8.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/136.26dcb103.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/137.a26ecf04.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/138.b80b9f28.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/139.8e1c1792.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/14.529d745c.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/140.bd7d8e7e.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/141.9da5aa90.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/142.3821e1b0.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/16.4b36c9ee.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/17.98c323f8.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/18.ad063947.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/19.b44809c4.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/2.822a4767.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/20.3f340fc2.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/21.42e39332.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/22.a1312116.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/23.6af8f720.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/24.1635f011.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/25.09d8d966.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/26.e486d47a.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/27.b7e33aab.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/28.cdac539c.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/29.654b3f31.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/30.834bf5d3.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/31.718f526c.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/32.1b65575e.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/33.cecdfb79.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/34.131dfc6c.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/35.a5d99c4d.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/36.1cab9dc2.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/37.b79d78a3.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/38.5b908257.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/39.6c664833.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/40.8b85a258.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/41.0dbd19df.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/42.3e6f118a.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/43.00b5db07.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/44.89bb3f3a.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/45.e6579de1.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/46.ee60272f.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/47.c9eb8eab.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/48.d0dd4de3.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/49.dbd4505f.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/5.e9314484.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/50.ecd22652.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/51.ce349635.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/52.9ca24d9c.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/53.3350accb.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/54.4202e0e3.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/55.64e9f68c.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/56.51fc76f0.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/57.72b870ac.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/58.957d903b.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/59.7b4208d2.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/6.9c5c73f6.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/60.3685ab8c.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/61.e69c295b.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/62.281930f3.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/63.4a410d7d.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/64.80017a36.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/65.471281ad.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/66.dc85576d.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/67.09d5da4e.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/68.91dcc2c6.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/69.def9fdda.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/7.3215eb6b.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/70.765c5661.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/71.04d3338d.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/72.bc633bf4.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/73.55b987d3.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/74.d23a1ac0.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/75.2eba63ff.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/76.ce207662.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/77.020f2115.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/78.d249f495.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/79.92a69642.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/8.ac8573da.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/80.ec600f91.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/81.4cd45c74.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/82.b0e3ae65.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/83.03f00b6e.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/84.10f26442.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/85.9a13c1e3.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/86.47ae9af8.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/87.0c6a080a.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/88.fd86a554.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/89.55e5d905.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/9.423bcf7d.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/90.e1bccbdc.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/91.6efb2f91.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/92.e6b9b6b1.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/93.567ce885.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/94.b4b06e2f.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/95.d4942553.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/96.57ec0513.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/97.1d22a3be.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/98.0b730049.js"><link rel="prefetch" href="/TechnicalNotes/assets/js/99.59f06fc8.js">
    <link rel="stylesheet" href="/TechnicalNotes/assets/css/0.styles.a649f350.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><main><main slot="sidebar-top"><!----></main> <div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/TechnicalNotes/" class="home-link router-link-active"><!----> <span class="site-name">杉-技术笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/TechnicalNotes/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Web 开发
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/TechnicalNotes/front-end/HTML5/" class="nav-link">
  HTML5
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/front-end/CSS3/" class="nav-link">
  CSS3
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/front-end/JavaScript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/front-end/TypeScript/" class="nav-link">
  TypeScript
</a></li></ul></li><li class="dropdown-item"><h4>
          前端框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/TechnicalNotes/front-end/Vue2/" class="nav-link">
  Vue2
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/front-end/Vue3/" class="nav-link">
  Vue3
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/front-end/React/" class="nav-link">
  React
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/front-end/Webpack/" class="nav-link">
  Webpack
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/front-end/Vite/" class="nav-link">
  Vite
</a></li></ul></li><li class="dropdown-item"><h4>
          移动端开发
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/TechnicalNotes/front-end/Andorid/" class="nav-link">
  Andorid
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/front-end/Flutter/" class="nav-link">
  Flutter
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/front-end/WechatApplet/" class="nav-link">
  微信小程序
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/TechnicalNotes/front-end/Electron/" class="nav-link">
  Electron
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/front-end/DataInterface/" class="nav-link">
  数据结构与算法
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Java
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/TechnicalNotes/back-end/Java/" class="nav-link">
  Java 基础
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/back-end/Java/JavaWeb/" class="nav-link">
  JavaWeb
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/back-end/Java/Mybatis/" class="nav-link">
  Mybatis
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/back-end/Java/Spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/back-end/Java/SpringMVC/" class="nav-link">
  SpringMVC
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/back-end/Java/SpringBoot/" class="nav-link">
  SpringBoot
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/back-end/Java/JVM/" class="nav-link">
  JVM
</a></li></ul></li><li class="dropdown-item"><h4>
          Rust
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/TechnicalNotes/back-end/Rust/" class="nav-link">
  Rust
</a></li></ul></li><li class="dropdown-item"><h4>
          Node.js
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/TechnicalNotes/back-end/Node.js/" class="nav-link">
  Node.js
</a></li></ul></li><li class="dropdown-item"><h4>
          Python
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/TechnicalNotes/back-end/Python/" class="nav-link">
  Python 基础
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/back-end/Python/Flask/" class="nav-link">
  Flask
</a></li></ul></li><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/TechnicalNotes/back-end/DataBase/MySQL/" class="nav-link">
  MySQL
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/back-end/DataBase/Redis/" class="nav-link">
  Redis
</a></li></ul></li><li class="dropdown-item"><h4>
          PHP
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/TechnicalNotes/back-end/PHP/" class="nav-link">
  PHP 基础
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/back-end/PHP/ThinkPHP/" class="nav-link">
  ThinkPHP
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/TechnicalNotes/Other/Linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/TechnicalNotes/Other/Docker/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/TechnicalNotes/Other/Git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/TechnicalNotes/Other/WinPE/" class="nav-link">
  WinPE
</a></li><li class="dropdown-item"><!----> <a href="/TechnicalNotes/Other/Photoshop/" class="nav-link">
  Photoshop
</a></li><li class="dropdown-item"><!----> <a href="/TechnicalNotes/Other/Minecraft/" class="nav-link">
  Minecraft
</a></li><li class="dropdown-item"><!----> <a href="/TechnicalNotes/Other/FL Studio/" class="nav-link">
  FL Studio
</a></li></ul></div></div><div class="nav-item"><a href="https://firpe.cn/about" target="_blank" rel="noopener noreferrer" class="nav-link external">
  关于
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://firpe.cn/donate" target="_blank" rel="noopener noreferrer" class="nav-link external">
  投食 
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/TechnicalNotes/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Web 开发
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/TechnicalNotes/front-end/HTML5/" class="nav-link">
  HTML5
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/front-end/CSS3/" class="nav-link">
  CSS3
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/front-end/JavaScript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/front-end/TypeScript/" class="nav-link">
  TypeScript
</a></li></ul></li><li class="dropdown-item"><h4>
          前端框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/TechnicalNotes/front-end/Vue2/" class="nav-link">
  Vue2
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/front-end/Vue3/" class="nav-link">
  Vue3
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/front-end/React/" class="nav-link">
  React
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/front-end/Webpack/" class="nav-link">
  Webpack
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/front-end/Vite/" class="nav-link">
  Vite
</a></li></ul></li><li class="dropdown-item"><h4>
          移动端开发
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/TechnicalNotes/front-end/Andorid/" class="nav-link">
  Andorid
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/front-end/Flutter/" class="nav-link">
  Flutter
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/front-end/WechatApplet/" class="nav-link">
  微信小程序
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/TechnicalNotes/front-end/Electron/" class="nav-link">
  Electron
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/front-end/DataInterface/" class="nav-link">
  数据结构与算法
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Java
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/TechnicalNotes/back-end/Java/" class="nav-link">
  Java 基础
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/back-end/Java/JavaWeb/" class="nav-link">
  JavaWeb
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/back-end/Java/Mybatis/" class="nav-link">
  Mybatis
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/back-end/Java/Spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/back-end/Java/SpringMVC/" class="nav-link">
  SpringMVC
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/back-end/Java/SpringBoot/" class="nav-link">
  SpringBoot
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/back-end/Java/JVM/" class="nav-link">
  JVM
</a></li></ul></li><li class="dropdown-item"><h4>
          Rust
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/TechnicalNotes/back-end/Rust/" class="nav-link">
  Rust
</a></li></ul></li><li class="dropdown-item"><h4>
          Node.js
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/TechnicalNotes/back-end/Node.js/" class="nav-link">
  Node.js
</a></li></ul></li><li class="dropdown-item"><h4>
          Python
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/TechnicalNotes/back-end/Python/" class="nav-link">
  Python 基础
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/back-end/Python/Flask/" class="nav-link">
  Flask
</a></li></ul></li><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/TechnicalNotes/back-end/DataBase/MySQL/" class="nav-link">
  MySQL
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/back-end/DataBase/Redis/" class="nav-link">
  Redis
</a></li></ul></li><li class="dropdown-item"><h4>
          PHP
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/TechnicalNotes/back-end/PHP/" class="nav-link">
  PHP 基础
</a></li><li class="dropdown-subitem"><a href="/TechnicalNotes/back-end/PHP/ThinkPHP/" class="nav-link">
  ThinkPHP
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/TechnicalNotes/Other/Linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/TechnicalNotes/Other/Docker/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/TechnicalNotes/Other/Git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/TechnicalNotes/Other/WinPE/" class="nav-link">
  WinPE
</a></li><li class="dropdown-item"><!----> <a href="/TechnicalNotes/Other/Photoshop/" class="nav-link">
  Photoshop
</a></li><li class="dropdown-item"><!----> <a href="/TechnicalNotes/Other/Minecraft/" class="nav-link">
  Minecraft
</a></li><li class="dropdown-item"><!----> <a href="/TechnicalNotes/Other/FL Studio/" class="nav-link">
  FL Studio
</a></li></ul></div></div><div class="nav-item"><a href="https://firpe.cn/about" target="_blank" rel="noopener noreferrer" class="nav-link external">
  关于
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://firpe.cn/donate" target="_blank" rel="noopener noreferrer" class="nav-link external">
  投食 
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>docker</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/TechnicalNotes/Other/docker/" aria-current="page" class="active sidebar-link">概述</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#简介" class="sidebar-link">简介</a></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#结构" class="sidebar-link">结构</a></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#底层原理" class="sidebar-link">底层原理</a></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#和虚拟机的区别" class="sidebar-link">和虚拟机的区别</a></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#命令" class="sidebar-link">命令</a></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#帮助" class="sidebar-link">帮助</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#docker-help" class="sidebar-link">docker —help</a></li></ul></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#基本信息" class="sidebar-link">基本信息</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#docker-version" class="sidebar-link">docker version</a></li></ul></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#系统信息" class="sidebar-link">系统信息</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#docker-info" class="sidebar-link">docker info</a></li></ul></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#查看所有镜像" class="sidebar-link">查看所有镜像</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#docker-images" class="sidebar-link">docker images</a></li></ul></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#搜索镜像" class="sidebar-link">搜索镜像</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#docker-search" class="sidebar-link">docker search</a></li></ul></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#拉取镜像" class="sidebar-link">拉取镜像</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#docker-pull" class="sidebar-link">docker pull</a></li></ul></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#删除镜像" class="sidebar-link">删除镜像</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#docker-rmi" class="sidebar-link">docker rmi</a></li></ul></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#运行镜像" class="sidebar-link">运行镜像</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#docker-run" class="sidebar-link">docker run</a></li></ul></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#查看容器" class="sidebar-link">查看容器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#docker-ps" class="sidebar-link">docker ps</a></li></ul></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#退出容器" class="sidebar-link">退出容器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#exit" class="sidebar-link">exit</a></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#ctrl-p-q" class="sidebar-link">Ctrl + P + Q</a></li></ul></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#删除容器" class="sidebar-link">删除容器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#docker-rm" class="sidebar-link">docker rm</a></li></ul></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#启动容器" class="sidebar-link">启动容器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#docker-start" class="sidebar-link">docker start</a></li></ul></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#关闭容器" class="sidebar-link">关闭容器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#docker-stop" class="sidebar-link">docker stop</a></li></ul></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#重启容器" class="sidebar-link">重启容器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#docker-restart" class="sidebar-link">docker restart</a></li></ul></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#杀掉容器" class="sidebar-link">杀掉容器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#docker-kill" class="sidebar-link">docker kill</a></li></ul></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#启动-docker" class="sidebar-link">启动 Docker</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#systemctl-start-docker" class="sidebar-link">systemctl start docker</a></li></ul></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#查看日志" class="sidebar-link">查看日志</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#docker-logs" class="sidebar-link">docker logs</a></li></ul></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#后台启动" class="sidebar-link">后台启动</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#docker-run-d" class="sidebar-link">docker run -d</a></li></ul></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#查看容器信息" class="sidebar-link">查看容器信息</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#docker-inspect" class="sidebar-link">docker inspect</a></li></ul></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#进入正在运行的容器" class="sidebar-link">进入正在运行的容器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#docker-exec" class="sidebar-link">docker exec</a></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#docker-attach" class="sidebar-link">docker attach</a></li></ul></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#从容器内拷贝文件到主机" class="sidebar-link">从容器内拷贝文件到主机</a></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#查看docker内存占用" class="sidebar-link">查看Docker内存占用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#docker-stats" class="sidebar-link">docker stats</a></li></ul></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#联合文件系统" class="sidebar-link">联合文件系统</a></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#分层镜像" class="sidebar-link">分层镜像</a></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#自定义镜像" class="sidebar-link">自定义镜像</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#提交镜像" class="sidebar-link">提交镜像</a></li></ul></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#由来" class="sidebar-link">由来</a></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#使用" class="sidebar-link">使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#命令方式" class="sidebar-link">命令方式</a></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#权限设置" class="sidebar-link">权限设置</a></li></ul></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#具名挂载" class="sidebar-link">具名挂载</a></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#匿名挂载" class="sidebar-link">匿名挂载</a></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#实战" class="sidebar-link">实战</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#mysql数据同步" class="sidebar-link">mysql数据同步</a></li></ul></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#简介-2" class="sidebar-link">简介</a></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#官方-dockerfile" class="sidebar-link">官方 Dockerfile</a></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#命令-2" class="sidebar-link">命令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#构建镜像" class="sidebar-link">构建镜像</a></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#查看构建记录" class="sidebar-link">查看构建记录</a></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#cmd-与-entrypoint-区别" class="sidebar-link">CMD 与 ENTRYPOINT 区别</a></li></ul></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#实战-2" class="sidebar-link">实战</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#创建包含vim命令的centos镜像" class="sidebar-link">创建包含vim命令的centos镜像</a></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#自定义tomcat环境镜像" class="sidebar-link">自定义tomcat环境镜像</a></li></ul></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#发布镜像到-docker-hub" class="sidebar-link">发布镜像到 Docker Hub</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#发布镜像" class="sidebar-link">发布镜像</a></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#指定镜像标签" class="sidebar-link">指定镜像标签</a></li></ul></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#配置国内镜像站" class="sidebar-link">配置国内镜像站</a></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#发布镜像到阿里云镜像仓库" class="sidebar-link">发布镜像到阿里云镜像仓库</a></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#理解docker0" class="sidebar-link">理解Docker0</a></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#link" class="sidebar-link">--link</a></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#自定义网络" class="sidebar-link">自定义网络</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#查看所有的docker网络" class="sidebar-link">查看所有的docker网络</a></li></ul></li><li class="sidebar-sub-header"><a href="/TechnicalNotes/Other/docker/#网络连通" class="sidebar-link">网络连通</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h1> <h2 id="简介"><a href="#简介" class="header-anchor">#</a> 简介</h2> <p>官网：https://www.docker.com/</p> <p>文档：https://docs.docker.com/docker-for-windows/</p> <p>命令：https://docs.docker.com/engine/reference/run/</p> <p>仓库：https://hub.docker.com/</p> <p>Docker 是一个开源的应用容器引擎。</p> <p>Docker 的思想来自于集装箱，彼此之间隔离。</p> <p>Docker 通过隔离机制，可以将服务器利用到极致。</p> <p>Docker 容器完全使用沙箱机制，相互之间不会有任何接口。</p> <h2 id="结构"><a href="#结构" class="header-anchor">#</a> 结构</h2> <p><img src="/TechnicalNotes/assets/img/kuangstudyebb6ebca-b5f3-45ce-ae06-ee9899fa0398.35c6f555.png" alt="img"></p> <ul><li><strong>镜像</strong>（image）：Docker 镜像好比一个模板，可以用来创建<strong>容器</strong>（container），一个镜像可以创建多个容器。</li> <li><strong>容器</strong>（container）：容器可以理解为一个微型的系统。</li> <li><strong>仓库</strong>（repository）：存放镜像的地方。</li></ul> <h2 id="底层原理"><a href="#底层原理" class="header-anchor">#</a> 底层原理</h2> <p>Docker 是一个 <strong>Client-Server</strong> 结构的系统。</p> <p>Docker 的守护进程运行在主机上，通过 Socket 从客户端访问。</p> <p>Docker Server 接受 <strong>Docker-Client</strong> 的指令。</p> <p><img src="/TechnicalNotes/assets/img/kuangstudy5375096a-4612-4fae-a76c-83c4e82d817b.9643aa04.png" alt="img"></p> <h2 id="和虚拟机的区别"><a href="#和虚拟机的区别" class="header-anchor">#</a> 和虚拟机的区别</h2> <p>Docker所使用的<strong>容器化技术</strong>本质上属于<strong>虚拟化技术</strong>。</p> <p>提到虚拟化技术，最有名的就是<strong>虚拟机技术</strong>。</p> <blockquote><p>虚拟机原理示意图</p></blockquote> <p><img src="/TechnicalNotes/assets/img/kuangstudy2c1ac099-6cb4-48f4-9e18-356538ee7b40.7b4420d2.png" alt="img"></p> <p>它有以下明显的缺点：</p> <ul><li><strong>资源占用多</strong>。启动虚拟机非常占内存，对电脑资源有不小的占用。</li> <li><strong>冗余步骤多</strong>。启动虚拟机后，还需要进行一些步骤才能进入系统，效率比较低。</li> <li><strong>启动很慢</strong>。由于虚拟机是虚拟化一整个系统，其启动时间会比较缓慢，一般都需要几分钟。</li></ul> <blockquote><p>容器化原理示意图</p></blockquote> <p><img src="/TechnicalNotes/assets/img/kuangstudy55c24afc-de22-4028-aa3c-aeb6cf6a6f9f.22c90f70.png" alt="img"></p> <p>它不是模拟的完整操作系统，而是基于操作系统封装成了一个个小的运行环境。</p> <blockquote><p>区别</p></blockquote> <table><thead><tr><th></th> <th>传统虚拟机</th> <th>Docker</th></tr></thead> <tbody><tr><td>虚拟内容</td> <td>硬件 + 完整的操作系统 + 软件</td> <td>APP + LIB</td></tr> <tr><td>大小</td> <td>笨重，通常几个 G</td> <td>轻便几个 M 或 KB</td></tr> <tr><td>启动速度</td> <td>慢，分钟级</td> <td>快，秒级</td></tr></tbody></table> <blockquote><p>Docker 为什么比 VM 快</p></blockquote> <p><img src="/TechnicalNotes/assets/img/kuangstudyb69524e7-a8fc-4517-b7ba-c8ac22752ae7.a18eb916.png" alt="img"></p> <p>Docker 有着比 VM 更少的抽象层。</p> <p>Docker 主要用的是宿主机的内核，而 VM 需要 <strong>Guest OS</strong>。</p> <p>新建容器的时候，Docker 不需要像 VM 一样重新加载一个操作系统内核，避免了引导的过程。</p> <h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <p>Docker 是用 Go 语言开发的。</p> <p>Go 语言基于 <strong>C</strong> 和 <strong>C++</strong>，所以需要先安装 <strong>C</strong> 和 <strong>C++</strong> 环境。</p> <p>安装 <strong>C</strong> 环境</p> <div class="language- extra-class"><pre class="language-text"><code>yum -y install gcc
</code></pre></div><p>安装 <strong>C++</strong> 环境</p> <div class="language- extra-class"><pre class="language-text"><code>yum -y install gcc-c++
</code></pre></div><blockquote><p>3、环境准备</p></blockquote> <p>根据 Docker 官网的建议，需要再安装一些环境。</p> <div class="language- extra-class"><pre class="language-text"><code>yum install -y yum-utils device-mapper-persistent-data lvm2
</code></pre></div><blockquote><p>4、设置镜像仓库</p></blockquote> <p>这里官网建议我们安装国外的镜像仓库。</p> <p>由于对国外的网络限制，国内安装的话会非常慢，并很有可能失败。</p> <p>推荐国内用户安装阿里云镜像。</p> <div class="language- extra-class"><pre class="language-text"><code>yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</code></pre></div><blockquote><p>5、更新 yum 软件包索引</p></blockquote> <p>这里官网建议我们更新 yum 软件包索引：</p> <div class="language- extra-class"><pre class="language-text"><code>yum makecache fast
</code></pre></div><blockquote><p>6、安装 Docker</p></blockquote> <p>做完前面的准备工作，就可以开始安装 Docker 了</p> <div class="language- extra-class"><pre class="language-text"><code>yum -y install docker-ce docker-ce-cli containerd.io
</code></pre></div><p>这里的 <code>docker-ce</code> 指的是 Docker 的社区版。</p> <p>如果是需要企业版的话就改为 <code>docker-ee</code> ，不过企业版是收费的，而且功能也略有不同。</p> <p>官方更推荐社区版，所以这里我们安装<code>docker-ce</code>。</p> <h2 id="命令"><a href="#命令" class="header-anchor">#</a> 命令</h2> <p><img src="/TechnicalNotes/assets/img/kuangstudy3a77ae60-28ce-4866-b706-c0270f72aaff.377dcfd0.png" alt="img"></p> <h1 id="基本命令"><a href="#基本命令" class="header-anchor">#</a> 基本命令</h1> <h2 id="帮助"><a href="#帮助" class="header-anchor">#</a> 帮助</h2> <h3 id="docker-help"><a href="#docker-help" class="header-anchor">#</a> docker —help</h3> <p>Docker 的帮助命令是一个<strong>万能命令</strong>，可以用来查看 Docker 的<strong>所有命令</strong>。</p> <blockquote><p>语法</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token punctuation">[</span>命令<span class="token punctuation">]</span> --help
</code></pre></div><blockquote><p>查看镜像相关命令</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs ~<span class="token punctuation">]</span><span class="token comment"># docker images --help</span>
Usage:  <span class="token function">docker</span> images <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> <span class="token punctuation">[</span>REPOSITORY<span class="token punctuation">[</span>:TAG<span class="token punctuation">]</span><span class="token punctuation">]</span>
List images
Options:
  -a, --all             Show all images <span class="token punctuation">(</span>default hides intermediate images<span class="token punctuation">)</span>
      --digests         Show digests
  -f, --filter filter   Filter output based on conditions provided
      --format string   Pretty-print images using a Go template
      --no-trunc        Don't truncate output
  -q, --quiet           Only show image IDs
</code></pre></div><blockquote><p>查看容器相关命令</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs ~<span class="token punctuation">]</span><span class="token comment"># docker ps --help</span>
Usage:  <span class="token function">docker</span> <span class="token function">ps</span> <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span>
List containers
Options:
  -a, --all             Show all containers <span class="token punctuation">(</span>default shows just running<span class="token punctuation">)</span>
  -f, --filter filter   Filter output based on conditions provided
      --format string   Pretty-print containers using a Go template
  -n, --last int        Show n last created containers <span class="token punctuation">(</span>includes all states<span class="token punctuation">)</span> <span class="token punctuation">(</span>default -1<span class="token punctuation">)</span>
  -l, --latest          Show the latest created container <span class="token punctuation">(</span>includes all states<span class="token punctuation">)</span>
      --no-trunc        Don't truncate output
  -q, --quiet           Only display container IDs
  -s, --size            Display total <span class="token function">file</span> sizes
</code></pre></div><h2 id="基本信息"><a href="#基本信息" class="header-anchor">#</a> 基本信息</h2> <h3 id="docker-version"><a href="#docker-version" class="header-anchor">#</a> docker version</h3> <p>使用 <code>docker version</code> 命令可以查看 Docker 的基本信息。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs ~<span class="token punctuation">]</span><span class="token comment"># docker version</span>
Client: Docker Engine - Community
 Version:           <span class="token number">20.10</span>.11
 API version:       <span class="token number">1.41</span>
 Go version:        go1.16.9
 Git commit:        dea9396
 Built:             Thu Nov <span class="token number">18</span> 00:38:53 <span class="token number">2021</span>
 OS/Arch:           linux/amd64
 Context:           default
 Experimental:      <span class="token boolean">true</span>
Server: Docker Engine - Community
 Engine:
  Version:          <span class="token number">20.10</span>.11
  API version:      <span class="token number">1.41</span> <span class="token punctuation">(</span>minimum version <span class="token number">1.12</span><span class="token punctuation">)</span>
  Go version:       go1.16.9
  Git commit:       847da18
  Built:            Thu Nov <span class="token number">18</span> 00:37:17 <span class="token number">2021</span>
  OS/Arch:          linux/amd64
  Experimental:     <span class="token boolean">false</span>
 containerd:
  Version:          <span class="token number">1.4</span>.12
  GitCommit:        7b11cfaabd73bb80907dd23182b9347b4245eb5d
 runc:
  Version:          <span class="token number">1.0</span>.2
  GitCommit:        v1.0.2-0-g52b36a2
 docker-init:
  Version:          <span class="token number">0.19</span>.0
  GitCommit:        de40ad0
</code></pre></div><h2 id="系统信息"><a href="#系统信息" class="header-anchor">#</a> 系统信息</h2> <h3 id="docker-info"><a href="#docker-info" class="header-anchor">#</a> docker info</h3> <p>使用 <code>docker info</code> 命令可以查看 Docker 的系统信息。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs ~<span class="token punctuation">]</span><span class="token comment"># docker info</span>
Client:
 Context:    default
 Debug Mode: <span class="token boolean">false</span>
 Plugins:
  app: Docker App <span class="token punctuation">(</span>Docker Inc., v0.9.1-beta3<span class="token punctuation">)</span>
  buildx: Build with BuildKit <span class="token punctuation">(</span>Docker Inc., v0.6.3-docker<span class="token punctuation">)</span>
  scan: Docker Scan <span class="token punctuation">(</span>Docker Inc., v0.9.0<span class="token punctuation">)</span>
Server:
 Containers: <span class="token number">1</span>
  Running: <span class="token number">0</span>
  Paused: <span class="token number">0</span>
  Stopped: <span class="token number">1</span>
 Images: <span class="token number">1</span>
 Server Version: <span class="token number">20.10</span>.11
 Storage Driver: overlay2
  Backing Filesystem: extfs
  Supports d_type: <span class="token boolean">true</span>
  Native Overlay Diff: <span class="token boolean">true</span>
  userxattr: <span class="token boolean">false</span>
 Logging Driver: json-file
 Cgroup Driver: cgroupfs
 Cgroup Version: <span class="token number">1</span>
 Plugins:
  Volume: <span class="token builtin class-name">local</span>
  Network: bridge <span class="token function">host</span> ipvlan macvlan null overlay
  Log: awslogs fluentd gcplogs gelf journald json-file <span class="token builtin class-name">local</span> logentries splunk syslog
 Swarm: inactive
 Runtimes: io.containerd.runc.v2 io.containerd.runtime.v1.linux runc
 Default Runtime: runc
 Init Binary: docker-init
 containerd version: 7b11cfaabd73bb80907dd23182b9347b4245eb5d
 runc version: v1.0.2-0-g52b36a2
 init version: de40ad0
 Security Options:
  seccomp
   Profile: default
 Kernel Version: <span class="token number">3.10</span>.0-957.21.3.el7.x86_64
 Operating System: CentOS Linux <span class="token number">7</span> <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>
 OSType: linux
 Architecture: x86_64
 CPUs: <span class="token number">2</span>
 Total Memory: <span class="token number">1</span>.694GiB
 Name: sail
 ID: 2GYU:CVF3:LSAL:J37H:TGME:AOCA:BROB:PHCD:ZPN2:BQCG:GXHB:7Q3L
 Docker Root Dir: /var/lib/docker
 Debug Mode: <span class="token boolean">false</span>
 Registry: https://index.docker.io/v1/
 Labels:
 Experimental: <span class="token boolean">false</span>
 Insecure Registries:
  <span class="token number">127.0</span>.0.0/8
 Registry Mirrors:
  https://l6b75cm0.mirror.aliyuncs.com/
 Live Restore Enabled: <span class="token boolean">false</span>
</code></pre></div><h1 id="镜像命令"><a href="#镜像命令" class="header-anchor">#</a> 镜像命令</h1> <h2 id="查看所有镜像"><a href="#查看所有镜像" class="header-anchor">#</a> 查看所有镜像</h2> <h3 id="docker-images"><a href="#docker-images" class="header-anchor">#</a> docker images</h3> <p>可以使用 <code>docker images</code> 命令查看所有本地主机上的镜像。</p> <blockquote><p>该命令等价于 <code>docker image ls</code>。</p> <p>语法</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>docker images [参数] [镜像[:标签]]
</code></pre></div><p>命令后加上 [镜像[:标签]] 可以对镜像进行过滤。</p> <blockquote><p>参数</p></blockquote> <ul><li><code>-a</code>：显示所有镜像。</li> <li><code>-q</code>：只显示 ID。</li></ul> <blockquote><p>显示所有镜像</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> images
<span class="token function">docker</span> image <span class="token function">ls</span>
<span class="token function">docker</span> images -a
</code></pre></div><blockquote><p>只显示镜像的 ID</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> image -q
</code></pre></div><blockquote><p>显示所有镜像的 ID</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> images -aq
</code></pre></div><blockquote><p>对镜像进行过滤</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>docker images 镜像名:版本号
</code></pre></div><blockquote><p>结果分析</p></blockquote> <ul><li><strong>REPOSITORY</strong>：镜像名（镜像仓库源）。</li> <li><strong>TAG</strong>：镜像的标签。</li> <li><strong>IMAGE ID</strong>：镜像的 ID。</li> <li><strong>CREATED</strong>：镜像的创建时间。</li> <li><strong>SIZE</strong>：镜像的大小。</li></ul> <h2 id="搜索镜像"><a href="#搜索镜像" class="header-anchor">#</a> 搜索镜像</h2> <h3 id="docker-search"><a href="#docker-search" class="header-anchor">#</a> docker search</h3> <blockquote><p>语法</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>docker search [参数]
</code></pre></div><blockquote><p>参数</p></blockquote> <ul><li><code>-f</code> / <code>--filter</code>：根据过滤条件搜索。</li></ul> <blockquote><p>搜索仓库中的镜像，等价于网页搜索。</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> search mysql
</code></pre></div><blockquote><p>搜索出 Stars 大于 3000 的</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> search mysql -f<span class="token operator">=</span>STARS<span class="token operator">=</span><span class="token number">3000</span>
</code></pre></div><h2 id="拉取镜像"><a href="#拉取镜像" class="header-anchor">#</a> 拉取镜像</h2> <h3 id="docker-pull"><a href="#docker-pull" class="header-anchor">#</a> docker pull</h3> <blockquote><p>语法</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>docker pull [参数] 镜像名[:标签]
</code></pre></div><blockquote><p>如果不输入标签，默认拉取最新版镜像。</p> <p>参数</p></blockquote> <ul><li><code>-a</code>：拉取镜像的所有标签。</li> <li><code>-q</code>：抑制详细输出。</li></ul> <blockquote><p>默认下载最新版</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> pull redis
<span class="token comment">#输出信息</span>
Using default tag: latest <span class="token comment"># 默认最新版标签</span>
latest: Pulling from library/redis
e5ae68f74026: Pull complete <span class="token comment"># 分层下载，docker image的核心：联合文件系统</span>
37c4354629da: Pull complete 
b065b1b1fa0f: Pull complete 
6954d19bb2e5: Pull complete 
6333f8baaf7c: Pull complete 
f9772c8a44e7: Pull complete 
Digest: sha256:2f502d27c3e9b54295f1c591b3970340d02f8a5824402c8179dcd20d4076b796 <span class="token comment">#防伪签名</span>
Status: Downloaded newer image <span class="token keyword">for</span> redis:latest
docker.io/library/redis:latest <span class="token comment"># 真实地址，docker pull redis 等价于 docker pull docker.io/library/redis:latest</span>
</code></pre></div><blockquote><p>指定版本下载</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> pull redis:5.0
<span class="token comment">#输出信息</span>
<span class="token number">5.0</span>: Pulling from library/redis
e5ae68f74026: Already exists <span class="token comment"># 分层镜像的好处，与之前的版本共用一部分，不用再重复下载</span>
37c4354629da: Already exists 
b065b1b1fa0f: Already exists 
99ab464ba8bb: Pull complete 
eb5bbe3179d2: Pull complete 
2067794f93b6: Pull complete 
Digest: sha256:310f81701011175dc868e833d73f539282dd18510ca35d6f7b63c4d33ab4f54e
Status: Downloaded newer image <span class="token keyword">for</span> redis:5.0
docker.io/library/redis:5.0
</code></pre></div><p>版本来自于官网，版本库 https://hub.docker.com/_/redis</p> <p><img src="/TechnicalNotes/assets/img/kuangstudy739b8422-fc80-4425-bda9-fccb3cf5d06d.d02d2860.png" alt="img"></p> <blockquote><p>这里输入的标签必须是官网版本库存在的标签，否则无法拉取镜像。</p></blockquote> <h2 id="删除镜像"><a href="#删除镜像" class="header-anchor">#</a> 删除镜像</h2> <h3 id="docker-rmi"><a href="#docker-rmi" class="header-anchor">#</a> docker rmi</h3> <blockquote><p>语法</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> rmi <span class="token punctuation">[</span>参数<span class="token punctuation">]</span> 镜像 <span class="token punctuation">[</span>镜像<span class="token punctuation">..</span>.<span class="token punctuation">]</span>
</code></pre></div><blockquote><p>参数</p></blockquote> <ul><li><code>-f</code>：强制删除。</li></ul> <blockquote><p>查看现存镜像</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> images
</code></pre></div><blockquote><p>删除一个。可以通过名称，也可以指定 ID，<code>-f</code> 表示强制删除。</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> rmi -f 镜像id
</code></pre></div><blockquote><p>删除多个。用空格分隔 ID。</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> rmi -f 镜像a的id 镜像b的id
</code></pre></div><blockquote><p>删除所有。先用 <code>docker images -aq</code> 查询出所有镜像，再使用 <code>docker rmi -f</code> 递归删除。</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> rmi -f <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> images -aq<span class="token variable">)</span></span>
</code></pre></div><h2 id="运行镜像"><a href="#运行镜像" class="header-anchor">#</a> 运行镜像</h2> <h3 id="docker-run"><a href="#docker-run" class="header-anchor">#</a> docker run</h3> <blockquote><p>语法</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>docker run [参数] 镜像名
</code></pre></div><blockquote><p>参数</p></blockquote> <ul><li><p><code>--name</code>：指定容器的名称，如果正在运行该名称的容器，会报错。</p></li> <li><p><code>--rm</code>：用完即删除，通常用来测试。</p></li> <li><p><code>-d</code>：后台方式运行。</p></li> <li><p><code>-it</code>：使用交互方式运行，可以进入容器查看内容。</p></li> <li><p><code>-e</code>：指定运行环境。</p></li> <li><p><code>-p</code>：随机指定端口。</p></li> <li><div class="language- extra-class"><pre class="language-text"><code>-p
</code></pre></div><p>：指定容器的端口，如：</p> <div class="language- extra-class"><pre class="language-text"><code>-p 8080:8080
</code></pre></div><p>。还可以有以下写法：</p> <ul><li><code>-p ip:主机端口:容器端口</code></li> <li><code>-p 主机端口:容器端口</code></li> <li><code>-p 容器端口</code></li></ul></li></ul> <blockquote><p>运行 centos 镜像</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> run -it centos /bin/bash
<span class="token comment">#输出信息</span>
Unable to <span class="token function">find</span> image <span class="token string">'centos:latest'</span> locally <span class="token comment"># 检索本地镜像，发现没有该镜像，则去仓库中搜索。</span>
latest: Pulling from library/centos <span class="token comment"># 开始从仓库中拉取</span>
a1d0c7532777: Pull complete 
Digest: sha256:a27fd8080b517143cbbbab9dfb7c8571c40d67d534bbdee55bd6c473f432b177
Status: Downloaded newer image <span class="token keyword">for</span> centos:latest
<span class="token punctuation">[</span>root@81c83ea42dc0 /<span class="token punctuation">]</span><span class="token comment"># ls # 由于是以交互方式运行，且进入 /bin/bash 中，此时的路径即为 centos 容器中的 /bin/bash</span>
bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
</code></pre></div><blockquote><p>由此可以看出，容器就是一个微型的 Linux 系统。它只保留了最核心的功能和最基本的命令，方便进行操作。</p></blockquote> <h1 id="容器命令"><a href="#容器命令" class="header-anchor">#</a> 容器命令</h1> <h2 id="查看容器"><a href="#查看容器" class="header-anchor">#</a> 查看容器</h2> <h3 id="docker-ps"><a href="#docker-ps" class="header-anchor">#</a> docker ps</h3> <blockquote><p>语法</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token function">ps</span> <span class="token punctuation">[</span>参数<span class="token punctuation">]</span>
</code></pre></div><blockquote><p>参数</p></blockquote> <ul><li><code>-a</code>：查看所有容器（包括正在运行的和已经停止的）。</li> <li><code>-n</code>：显示最近创建的容器，设置显示个数。</li> <li><code>-q</code>：只显示容器的编号。</li></ul> <blockquote><p>查看正在运行的容器</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code> <span class="token function">docker</span> <span class="token function">ps</span>
<span class="token comment"># 输出内容</span>
CONTAINER ID   IMAGE     COMMAND       CREATED              STATUS              PORTS     NAMES
1aaf76d85b9e   centos    <span class="token string">&quot;/bin/bash&quot;</span>   About a minute ago   Up About a minute             intelligent_proskuriakova
</code></pre></div><blockquote><p>查看所有容器</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token function">ps</span> -a
</code></pre></div><blockquote><p>显示最近创建的 2 个容器</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token function">ps</span> -a -n<span class="token operator">=</span><span class="token number">2</span>
</code></pre></div><blockquote><p>只显示容器的 ID</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token function">ps</span> -aq
</code></pre></div><h2 id="退出容器"><a href="#退出容器" class="header-anchor">#</a> 退出容器</h2> <h3 id="exit"><a href="#exit" class="header-anchor">#</a> exit</h3> <p>进入容器后，可以使用 <code>exit</code> 退出</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#先运行一个容器</span>
<span class="token function">docker</span> run -it centos /bin/bash
<span class="token comment">#退出容器</span>
<span class="token builtin class-name">exit</span>
</code></pre></div><p>由此可见，这样退出后容器也会停止。</p> <h3 id="ctrl-p-q"><a href="#ctrl-p-q" class="header-anchor">#</a> Ctrl + P + Q</h3> <p>如果想退出后容器不停止，可以使用 <code>Ctrl + P + Q</code> 快捷键退出。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#运行一个容器</span>
<span class="token function">docker</span> run -it centos /bin/bash
<span class="token comment">#使用ctrl + P + Q 快捷键退出后 在查看运行的容器</span>
<span class="token function">docker</span> <span class="token function">ps</span> 
CONTAINER ID   IMAGE     COMMAND       CREATED         STATUS         PORTS     NAMES
1aaf76d85b9e   centos    <span class="token string">&quot;/bin/bash&quot;</span>   <span class="token number">8</span> seconds ago   Up <span class="token number">8</span> seconds             intelligent_proskuriakova
</code></pre></div><h2 id="删除容器"><a href="#删除容器" class="header-anchor">#</a> 删除容器</h2> <h3 id="docker-rm"><a href="#docker-rm" class="header-anchor">#</a> docker rm</h3> <blockquote><p>语法</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>docker rm [参数] 容器 [容器...]
</code></pre></div><blockquote><p>参数</p></blockquote> <ul><li><code>-f</code>：强制删除。</li></ul> <blockquote><p>删除指定容器（不能删除正在运行的容器）</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#假设 1aaf76d85b9e这个容器正在运行，进行删除</span>
<span class="token function">docker</span> <span class="token function">rm</span> 1aaf76d85b9e
<span class="token comment">#提示你需要停止后在删除</span>
Error response from daemon: You cannot remove a running container 1aaf76d85b9ee5002411c1ea390fca05819f19dc400e85127731d37455cb0acc. Stop the container before attempting removal or force remove
</code></pre></div><blockquote><p>强制删除指定容器</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token function">rm</span> -f 容器id
</code></pre></div><blockquote><p>删除所有容器。先使用 <code>docker ps -aq</code> 获取所有容器的 ID，再调用 <code>docker rm -f</code> 递归删除。</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token function">rm</span> -f <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> <span class="token function">ps</span> -aq<span class="token variable">)</span></span>
</code></pre></div><blockquote><p>删除所有容器。使用管道符 <code>|</code> 获取 Docker 相关的所有容器 ID 并使用 <code>docker rm -f</code> 删除。</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code> <span class="token function">docker</span> <span class="token function">ps</span> -a -q<span class="token operator">|</span><span class="token function">xargs</span> <span class="token function">docker</span> <span class="token function">rm</span> -f
</code></pre></div><h2 id="启动容器"><a href="#启动容器" class="header-anchor">#</a> 启动容器</h2> <h3 id="docker-start"><a href="#docker-start" class="header-anchor">#</a> docker start</h3> <blockquote><p>运行关闭的容器</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> start 容器id
</code></pre></div><h2 id="关闭容器"><a href="#关闭容器" class="header-anchor">#</a> 关闭容器</h2> <h3 id="docker-stop"><a href="#docker-stop" class="header-anchor">#</a> docker stop</h3> <blockquote><p>关闭运行的容器</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> stop 容器id
</code></pre></div><h2 id="重启容器"><a href="#重启容器" class="header-anchor">#</a> 重启容器</h2> <h3 id="docker-restart"><a href="#docker-restart" class="header-anchor">#</a> docker restart</h3> <blockquote><p>重启关闭的容器</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> restart 容器id
</code></pre></div><h2 id="杀掉容器"><a href="#杀掉容器" class="header-anchor">#</a> 杀掉容器</h2> <h3 id="docker-kill"><a href="#docker-kill" class="header-anchor">#</a> docker kill</h3> <blockquote><p>杀掉运行的容器</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token function">kill</span> 容器id
</code></pre></div><h1 id="常用命令"><a href="#常用命令" class="header-anchor">#</a> 常用命令</h1> <h2 id="启动-docker"><a href="#启动-docker" class="header-anchor">#</a> 启动 Docker</h2> <h3 id="systemctl-start-docker"><a href="#systemctl-start-docker" class="header-anchor">#</a> systemctl start docker</h3> <p>在服务器关机或者重启后，是需要重新启动 Docker 的。 命令如下：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>systemctl start <span class="token function">docker</span>
</code></pre></div><h2 id="查看日志"><a href="#查看日志" class="header-anchor">#</a> 查看日志</h2> <h3 id="docker-logs"><a href="#docker-logs" class="header-anchor">#</a> docker logs</h3> <blockquote><p>语法</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code> docker logs [参数] 容器
</code></pre></div><blockquote><p>参数</p></blockquote> <ul><li><code>-f</code>：日志流动输出。</li> <li><code>-t</code>：展示时间戳。</li> <li><code>--tail</code>：从日志末尾显示的行数。</li></ul> <blockquote><p>为模拟日志输出效果，我们先编写一段脚本</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>while true;do echo sail;sleep 3;done
</code></pre></div><p>以上脚本实现的效果为：每隔 3 秒输出字符串 sail。</p> <blockquote><p>以脚本启动容器</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#启动容器</span>
<span class="token function">docker</span> run -d centos /bin/sh -c <span class="token string">&quot;while true;do echo sail;sleep 3;done&quot;</span>
<span class="token comment">#查看该容器的日志信息</span>
<span class="token function">docker</span> logs -f -t --tail <span class="token number">10</span> 容器id
<span class="token number">2021</span>-12-10T03:01:28.607288480Z sail
<span class="token number">2021</span>-12-10T03:01:31.609334595Z sail
<span class="token number">2021</span>-12-10T03:01:34.611361943Z sail
<span class="token number">2021</span>-12-10T03:01:37.613461457Z sail
<span class="token number">2021</span>-12-10T03:01:40.615619089Z sail
<span class="token number">2021</span>-12-10T03:01:43.617595572Z sail
</code></pre></div><p>可以看到，按此命令会看到容器最后 10 条日志，且每隔 3 秒滚动输出一条日志。</p> <h2 id="后台启动"><a href="#后台启动" class="header-anchor">#</a> 后台启动</h2> <h3 id="docker-run-d"><a href="#docker-run-d" class="header-anchor">#</a> docker run -d</h3> <blockquote><p>语法</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>docker run -d 镜像
</code></pre></div><blockquote><p>后台启动镜像</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> run -d centos
</code></pre></div><blockquote><p>使用 <code>docker run -d</code> 启动，也并不能保证容器一定能在后台运行，如果没有前台使用，容器启动后发现自己没有提供服务，会立刻停止。</p></blockquote> <p>前面的 <code>docker run -d centos /bin/sh -c &quot;while true;do echo sail;sleep 3;done&quot;</code> 命令，由于启动后运行了脚本打印日志，即提供了服务，所以不会停止。</p> <h2 id="查看容器信息"><a href="#查看容器信息" class="header-anchor">#</a> 查看容器信息</h2> <h3 id="docker-inspect"><a href="#docker-inspect" class="header-anchor">#</a> docker inspect</h3> <blockquote><p>语法</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> inspect 容器
</code></pre></div><blockquote><p>示例</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> inspect 容器id
</code></pre></div><blockquote><p>不管容器是否运行，都可以使用该命令查看。</p></blockquote> <h2 id="进入正在运行的容器"><a href="#进入正在运行的容器" class="header-anchor">#</a> 进入正在运行的容器</h2> <p>容器是一个微型的 Linux 系统，我们通常需要进入容器进行操作。</p> <h3 id="docker-exec"><a href="#docker-exec" class="header-anchor">#</a> docker exec</h3> <p>使用 <code>docker exec</code> 可以进入容器并开启一个新的终端，可以在里面操作。</p> <blockquote><p>语法</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>docker exec [参数] 容器 路径
</code></pre></div><blockquote><p>参数</p></blockquote> <ul><li><code>-d</code>：后台运行。</li> <li><code>-it</code>：交互模式进入。</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it 容器id /bin/bash
</code></pre></div><p>这种进入方式是单独开了一个新进程的方式。</p> <h3 id="docker-attach"><a href="#docker-attach" class="header-anchor">#</a> docker attach</h3> <p>使用 <code>docker attach</code> 会进入容器正在执行的终端，不会启动新的进程。</p> <blockquote><p>语法</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> attach 容器id
</code></pre></div><p>这种进入方式没有开启新的进程（<code>/bin/bash</code> 是 centos 容器的默认终端）。</p> <h2 id="从容器内拷贝文件到主机"><a href="#从容器内拷贝文件到主机" class="header-anchor">#</a> 从容器内拷贝文件到主机</h2> <blockquote><p>进入容器，创建一个文件</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#进入容器</span>
<span class="token function">docker</span> attach 96ed3fe3e7f1
<span class="token comment">#进入home目录</span>
<span class="token builtin class-name">cd</span> /home
<span class="token comment">#创建一个文件</span>
<span class="token function">touch</span> test.java 
<span class="token comment">#查看文件</span>
<span class="token function">ls</span>
<span class="token comment">#test.java</span>
<span class="token comment">#退出容器</span>
<span class="token builtin class-name">exit</span>
</code></pre></div><blockquote><p>退出容器后，不管容器是否启动，都可以复制容器中的文件到主机上</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#进入主机上的home目录</span>
<span class="token builtin class-name">cd</span> /home
<span class="token comment">#复制</span>
<span class="token function">docker</span> <span class="token function">cp</span> 容器id:/home/test.java /home
<span class="token comment">#查看home目录下的文件</span>
<span class="token function">ls</span>
admin  f2  f3  sail  test.java
</code></pre></div><blockquote><p>这种方式是一个手动过程，很不方便，推荐使用<strong>数据卷技术</strong>，可以实现自动同步主机和容器的目录。</p></blockquote> <h2 id="查看docker内存占用"><a href="#查看docker内存占用" class="header-anchor">#</a> 查看Docker内存占用</h2> <h3 id="docker-stats"><a href="#docker-stats" class="header-anchor">#</a> docker stats</h3> <blockquote><p>语法</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> stats <span class="token punctuation">[</span>参数<span class="token punctuation">]</span> <span class="token punctuation">[</span>容器<span class="token punctuation">..</span>.<span class="token punctuation">]</span>
</code></pre></div><blockquote><p>参数</p></blockquote> <ul><li><code>-a</code>：查看所有容器的内存占用（默认只展示运行的容器）。</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> stats -a
</code></pre></div><h1 id="镜像原理"><a href="#镜像原理" class="header-anchor">#</a> 镜像原理</h1> <h2 id="联合文件系统"><a href="#联合文件系统" class="header-anchor">#</a> 联合文件系统</h2> <p><strong>联合文件系统</strong>（UnionFS）是 Docker 的核心，也是 Docker 得以极致精简的保证。</p> <p>以拉取 redis 镜像为例</p> <blockquote><p>先拉取最新版镜像</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> pull redis
Using default tag: latest <span class="token comment"># 默认最新版标签</span>
latest: Pulling from library/redis
e5ae68f74026: Pull complete <span class="token comment"># 分层下载，docker image的核心：联合文件系统</span>
37c4354629da: Pull complete 
b065b1b1fa0f: Pull complete 
6954d19bb2e5: Pull complete 
6333f8baaf7c: Pull complete 
f9772c8a44e7: Pull complete 
Digest: sha256:2f502d27c3e9b54295f1c591b3970340d02f8a5824402c8179dcd20d4076b796 <span class="token comment">#防伪签名</span>
Status: Downloaded newer image <span class="token keyword">for</span> redis:latest
docker.io/library/redis:latest <span class="token comment"># 真实地址，docker pull redis 等价于 docker pull docker.io/library/redis:latest</span>
</code></pre></div><blockquote><p>再拉取指定版镜像</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> pull redis:5.0
<span class="token number">5.0</span>: Pulling from library/redis
e5ae68f74026: Already exists <span class="token comment"># 分层镜像的好处，与之前的版本共用一部分，不用再重复下载</span>
37c4354629da: Already exists 
b065b1b1fa0f: Already exists 
99ab464ba8bb: Pull complete 
eb5bbe3179d2: Pull complete 
2067794f93b6: Pull complete 
Digest: sha256:310f81701011175dc868e833d73f539282dd18510ca35d6f7b63c4d33ab4f54e
Status: Downloaded newer image <span class="token keyword">for</span> redis:5.0
docker.io/library/redis:5.0
</code></pre></div><p>由此可见，redis 镜像一共 6 层，由于之前拉取了默认的最新版 <strong>redis</strong> 镜像，再拉取 <strong>redis:5.0</strong> 时，有 3 层是可以复用的，所以只下载了不能复用的 3 层。</p> <blockquote><p>这样既能提高下载速度，也能极大节省磁盘占用和资源消耗。</p></blockquote> <h2 id="分层镜像"><a href="#分层镜像" class="header-anchor">#</a> 分层镜像</h2> <p>Docker 使用联合文件系统对镜像做了分层，如下图所示：</p> <p><img src="/TechnicalNotes/assets/img/kuangstudyf272761f-94ea-4876-911b-e799cbe9ffc7.4631c3e1.png" alt="img"></p> <ul><li><strong>bootfs</strong>（boot file system）：启动文件系统。</li> <li><strong>rootfs</strong>：root file system：基础文件系统。</li></ul> <p><img src="/TechnicalNotes/assets/img/kuangstudy30e38d90-d7a3-42d2-bf41-6960671faade.5cbbdc93.png" alt="img"></p> <p><img src="/TechnicalNotes/assets/img/kuangstudybe416430-40e9-4246-8799-a221a1a034dd.f0707c6c.png" alt="img"></p> <p><img src="/TechnicalNotes/assets/img/kuangstudy8f77faaf-727e-4acb-a9da-5da10c5417cc.167d1b21.png" alt="img"></p> <p>Docker 镜像都是<strong>只读</strong>的，当容器启动时，一个新的可写层被加到镜像的顶部。</p> <p>这一层就是我们通常说的<strong>容器层</strong>，容器层之下的都叫<strong>镜像层</strong>。</p> <p><img src="/TechnicalNotes/assets/img/kuangstudy8d1de69f-280f-4372-99d5-6c0e145e24f0.46b50e22.png" alt="img"></p> <h2 id="自定义镜像"><a href="#自定义镜像" class="header-anchor">#</a> 自定义镜像</h2> <p>我们日常拉取的镜像是由别人制作再提交到仓库的。</p> <p>我们自己也是可以制作镜像并提交的，使用 <code>docker commit</code> 命令。</p> <h3 id="提交镜像"><a href="#提交镜像" class="header-anchor">#</a> 提交镜像</h3> <h4 id="docker-commit"><a href="#docker-commit" class="header-anchor">#</a> docker commit</h4> <blockquote><p>语法</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> commit <span class="token punctuation">[</span>参数<span class="token punctuation">]</span> 容器 <span class="token punctuation">[</span>仓库<span class="token punctuation">[</span>:标签<span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre></div><blockquote><p>参数</p></blockquote> <ul><li><code>-a</code>：作者信息。一般为 <strong>作者名字&lt;邮箱&gt;</strong>。</li> <li><code>-c</code>：将 <strong>Dockerfile</strong> 指令应用于创建的映像。</li> <li><code>-m</code>：注释信息。</li> <li><code>-p</code>：提交期间暂停容器（默认）。</li></ul> <blockquote><p>提交自定义镜像</p></blockquote> <blockquote><p>将这个容器创建为一个自定义的镜像并提交到仓库中。</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> commit -a<span class="token operator">=</span><span class="token string">&quot;提交人信息&quot;</span> -m<span class="token operator">=</span><span class="token string">&quot;注释信息&quot;</span> 要提交的容器 镜像名:版本号
</code></pre></div><h1 id="数据卷"><a href="#数据卷" class="header-anchor">#</a> 数据卷</h1> <h2 id="由来"><a href="#由来" class="header-anchor">#</a> 由来</h2> <p>Docker 是将应用和环境打包成一个镜像。</p> <p>这样，数据就不应该保存在容器中，否则容器删除，数据就会丢失，有着非常大的风险。</p> <p>为此，容器和主机之间需要有一个数据共享技术，使得在 Docker 容器中产生的数据能够同步到本地。</p> <p>这就是<strong>数据卷</strong>技术。其本质上是一个<strong>目录挂载</strong>，将容器内的目录挂载到主机上。</p> <h2 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h2> <h3 id="命令方式"><a href="#命令方式" class="header-anchor">#</a> 命令方式</h3> <blockquote><p>语法</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> run -v 主机目录:容器目录
</code></pre></div><blockquote><p>查看主机 <code>/home</code> 目录。</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs ~<span class="token punctuation">]</span> <span class="token function">ls</span> /home
admin  f2  f3  sail  test.java
</code></pre></div><blockquote><p>以交互模式启动 centos 镜像。</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs ~<span class="token punctuation">]</span><span class="token comment"># docker run -it -v /home/ceshi:/home centos /bin/bash</span>
<span class="token punctuation">[</span>root@ec95646b1a4c /<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre></div><blockquote><p>新开一个窗口查看容器详情。</p></blockquote> <p><img src="/TechnicalNotes/assets/img/kuangstudy96df1ea0-f246-4f02-a47b-900d870790e7.0c283ff5.png" alt="img"></p> <p><strong>Mounts</strong> 下的 <strong>Source</strong> 即为设置的主机目录、<strong>Destination</strong> 即为设置的容器目录，他们已经绑定在了一起。</p> <blockquote><p>在主机中查看 <code>/home</code>。</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs /<span class="token punctuation">]</span><span class="token comment"># cd /home</span>
<span class="token punctuation">[</span>root@qzs home<span class="token punctuation">]</span><span class="token comment"># ls</span>
admin  ceshi  f2  f3  sail  test.java
</code></pre></div><p>主机上的 <code>/home</code> 下已经有了 <code>ceshi</code> 目录。说明容器一经启动，就会在主机生成对应的挂载目录。</p> <blockquote><p>在容器中的 <code>/home</code> 下新建一个文件。</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@ec95646b1a4c /<span class="token punctuation">]</span><span class="token comment"># cd /home</span>
<span class="token punctuation">[</span>root@ec95646b1a4c home<span class="token punctuation">]</span><span class="token comment"># ls</span>
<span class="token punctuation">[</span>root@ec95646b1a4c home<span class="token punctuation">]</span><span class="token comment"># touch test.java</span>
<span class="token punctuation">[</span>root@ec95646b1a4c home<span class="token punctuation">]</span><span class="token comment"># ls</span>
test.java
</code></pre></div><blockquote><p>查看主机的 <code>ceshi</code> 目录。</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs home<span class="token punctuation">]</span><span class="token comment"># cd ceshi</span>
<span class="token punctuation">[</span>root@qzs ceshi<span class="token punctuation">]</span><span class="token comment"># ls</span>
test.java
</code></pre></div><p>此时主机中的 <code>ceshi</code> 目录下也有了这个文件。</p> <blockquote><p>关闭容器。</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@ec95646b1a4c home<span class="token punctuation">]</span><span class="token comment"># exit</span>
<span class="token builtin class-name">exit</span>
</code></pre></div><blockquote><p>修改主机中 <code>/home/ceshi/test.java</code> 文件的内容。</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs ceshi<span class="token punctuation">]</span><span class="token comment"># vim test.java</span>
<span class="token comment"># 此处编辑文件过程省略</span>
<span class="token punctuation">[</span>root@qzs ceshi<span class="token punctuation">]</span><span class="token comment"># cat test.java</span>
hello sail
</code></pre></div><blockquote><p>重启容器。</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs ~<span class="token punctuation">]</span><span class="token comment"># docker start ec95646b1a4cec95646b1a4c</span>
<span class="token punctuation">[</span>root@qzs ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE          COMMAND             CREATED          STATUS         PORTS           NAME
Sec95646b1a4c   centos         <span class="token string">&quot;/bin/bash&quot;</span>         <span class="token number">19</span> minutes ago   Up <span class="token number">5</span> seconds                            charming_cartwright
</code></pre></div><blockquote><p>查看 <code>/home</code> 下的文件。</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it ec95646b1a4c /bin/bash</span>
<span class="token punctuation">[</span>root@ec95646b1a4c /<span class="token punctuation">]</span><span class="token comment"># cd /home</span>
<span class="token punctuation">[</span>root@ec95646b1a4c home<span class="token punctuation">]</span><span class="token comment"># ls</span>
test.java
<span class="token punctuation">[</span>root@ec95646b1a4c home<span class="token punctuation">]</span><span class="token comment"># cat test.java</span>
hello sail
</code></pre></div><p>此时容器中的文件也更改了。</p> <blockquote><p>由此可见，数据卷技术实现的是双向同步。</p></blockquote> <h3 id="权限设置"><a href="#权限设置" class="header-anchor">#</a> 权限设置</h3> <p>在使用命令方式设置卷时，还可以指定权限，以此保证数据安全。</p> <blockquote><p>参数</p></blockquote> <ul><li><code>ro</code>(readonly)：只读。</li> <li><code>rw</code>(readwrite)：可读可写。</li></ul> <blockquote><p>以数据卷只读权限启动镜像。</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs mysql<span class="token punctuation">]</span><span class="token comment"># docker run -it -v /home/qzs:/home:ro centos /bin/bash</span>
</code></pre></div><blockquote><p>新建文件测试。</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@02ef70c94920 home<span class="token punctuation">]</span><span class="token comment"># touch test.java</span>
touch: cannot <span class="token function">touch</span> <span class="token string">'test.java'</span><span class="token builtin class-name">:</span> Read-only <span class="token function">file</span> system
</code></pre></div><p>容器内部该目录是没有写入权限的。</p> <blockquote><p>以数据卷可读可写的权限启动镜像。</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs mysql<span class="token punctuation">]</span><span class="token comment"># docker run -it -v /home/qzs:/home:rw centos /bin/bash</span>
<span class="token punctuation">[</span>root@48678e08f868 /<span class="token punctuation">]</span><span class="token comment"># cd /home</span>
<span class="token punctuation">[</span>root@48678e08f868 home<span class="token punctuation">]</span><span class="token comment"># touch test.java</span>
<span class="token punctuation">[</span>root@48678e08f868 home<span class="token punctuation">]</span><span class="token comment"># ls</span>
apache-tomcat-9.0.55.tar.gz  jdk-8u301-linux-x64.rpm  test.java
</code></pre></div><blockquote><p>新建文件测试。</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs mysql<span class="token punctuation">]</span><span class="token comment"># docker run -it -v /home/sail:/home:rw centos /bin/bash</span>
<span class="token punctuation">[</span>root@48678e08f868 /<span class="token punctuation">]</span><span class="token comment"># cd /home</span>
<span class="token punctuation">[</span>root@48678e08f868 home<span class="token punctuation">]</span><span class="token comment"># touch test.java</span>
<span class="token punctuation">[</span>root@48678e08f868 home<span class="token punctuation">]</span><span class="token comment"># ls</span>
apache-tomcat-9.0.55.tar.gz  jdk-8u301-linux-x64.rpm  test.java
</code></pre></div><p>容器内部该目录写入是没有问题的。</p> <blockquote><p>前面我们没有指定权限也可以写入，由此可见，数据卷默认是具有读写权限的。</p></blockquote> <h2 id="具名挂载"><a href="#具名挂载" class="header-anchor">#</a> 具名挂载</h2> <blockquote><p>启动镜像时只定义主机卷名称，不指定挂载目录。</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs mysql<span class="token punctuation">]</span><span class="token comment"># docker run -it -v my-centos:/home centos /bin/bash</span>
<span class="token punctuation">[</span>root@3cf74e9e6973 /<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre></div><blockquote><p>查看目前挂载的卷。</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 使用 Ctrl + P + Q 不退出容器的情况下回到主机目录。</span>
<span class="token punctuation">[</span>root@qzs mysql<span class="token punctuation">]</span><span class="token comment"># docker volume ls</span>
DRIVER    VOLUME NAME
<span class="token builtin class-name">local</span>     my-centos
</code></pre></div><blockquote><p>查看卷的详情。</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs mysql<span class="token punctuation">]</span><span class="token comment"># docker volume inspect my-centos</span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">&quot;CreatedAt&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2021-12-20T16:55:35+08:00&quot;</span>,
        <span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>,
        <span class="token string">&quot;Labels&quot;</span><span class="token builtin class-name">:</span> null,
        <span class="token string">&quot;Mountpoint&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/var/lib/docker/volumes/my-centos/_data&quot;</span>,
        <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;my-centos&quot;</span>,
        <span class="token string">&quot;Options&quot;</span><span class="token builtin class-name">:</span> null,
        <span class="token string">&quot;Scope&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p>卷挂载在 <code>/var/lib/docker/volumes/卷名/_data</code> 目录下。</p> <p>在没有指定主机挂载目录的情况下，会默认挂载到该目录。</p> <blockquote><p>由于指定了卷名，所以这种方式称为具名挂载。</p></blockquote> <h2 id="匿名挂载"><a href="#匿名挂载" class="header-anchor">#</a> 匿名挂载</h2> <blockquote><p>启动镜像时只指定容器目录。</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs mysql<span class="token punctuation">]</span><span class="token comment"># docker run -it -v /home centos /bin/bash</span>
</code></pre></div><blockquote><p>查看目前挂载的卷。</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs mysql<span class="token punctuation">]</span><span class="token comment"># docker volume ls</span>
DRIVER    VOLUME NAME
<span class="token builtin class-name">local</span>     159830cf55550c9a39e845c1d96aa04cc762005bc0c64d15d5066834b47df940
</code></pre></div><blockquote><p>查看卷的详情。</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs mysql<span class="token punctuation">]</span><span class="token comment"># docker volume inspect 159830cf55550c9a39e845c1d96aa04cc762005bc0c64d15d5066834b47df940</span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">&quot;CreatedAt&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2021-12-20T17:05:23+08:00&quot;</span>,
        <span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>,
        <span class="token string">&quot;Labels&quot;</span><span class="token builtin class-name">:</span> null,
        <span class="token string">&quot;Mountpoint&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/var/lib/docker/volumes/159830cf55550c9a39e845c1d96aa04cc762005bc0c64d15d5066834b47df940/_data&quot;</span>,
        <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;159830cf55550c9a39e845c1d96aa04cc762005bc0c64d15d5066834b47df940&quot;</span>,
        <span class="token string">&quot;Options&quot;</span><span class="token builtin class-name">:</span> null,
        <span class="token string">&quot;Scope&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p>卷也是挂载在 <code>/var/lib/docker/volumes/xxx/_data</code> 目录下。</p> <p>在没有指定主机挂载目录的情况下，会默认挂载到该目录。</p> <blockquote><p>由于没有指定卷名，所以这种方式称为匿名挂载。</p></blockquote> <p>只有指定主机目录的情况下会挂载到指定目录，否则都会挂载到默认目录。</p> <h2 id="实战"><a href="#实战" class="header-anchor">#</a> 实战</h2> <h3 id="mysql数据同步"><a href="#mysql数据同步" class="header-anchor">#</a> mysql数据同步</h3> <p>数据库中的数据极为重要，必须同步到主机，否则将会有非常大的数据丢失风险。</p> <p>这里以 mysql 镜像为例演示数据同步的过程。</p> <blockquote><p>启动 mysql 镜像。</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>[root@qzs ~]# docker run -d -p 3310:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7
Unable to find image 'mysql:5.7' locally
5.7: Pulling from library/mysql
ffbb094f4f9e: Pull complete 
df186527fc46: Pull complete 
fa362a6aa7bd: Pull complete 
5af7cb1a200e: Pull complete 
949da226cc6d: Pull complete 
bce007079ee9: Pull complete 
eab9f076e5a3: Pull complete 
c7b24c3f27af: Pull complete 
6fc26ff6705a: Pull complete 
bec5cdb5e7f7: Pull complete 
6c1cb25f7525: Pull complete 
Digest: sha256:d1cc87a3bd5dc07defc837bc9084f748a130606ff41923f46dec1986e0dc828d
Status: Downloaded newer image for mysql:5.7
a016e564d977550e475474556cfd033fb1c731002381bc9f9544c63fccb7f60c
</code></pre></div><p>其中 <code>-e</code> 为环境配置。安装启动 mysql 需要配置密码。</p> <blockquote><p>使用<code>docker inspect</code>查看挂载情况。</p></blockquote> <p><img src="/TechnicalNotes/assets/img/kuangstudy37de2e6a-c038-41b1-90ec-c8e4c36a46f5.7c89af3e.png" alt="img"></p> <p>已经生成了两个目录的挂载。</p> <blockquote><p>查看主机同步的目录。</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs ~<span class="token punctuation">]</span><span class="token comment"># cd /home</span>
<span class="token punctuation">[</span>root@qzs home<span class="token punctuation">]</span><span class="token comment"># ls</span>
admin  ceshi  f2  f3  mysql  sail  test.java
<span class="token punctuation">[</span>root@qzs home<span class="token punctuation">]</span><span class="token comment"># cd mysql</span>
<span class="token punctuation">[</span>root@qzs mysql<span class="token punctuation">]</span><span class="token comment"># ls</span>
conf  data
</code></pre></div><p>主机已经同步了容器挂载的目录。</p> <h1 id="dockerfile"><a href="#dockerfile" class="header-anchor">#</a> DockerFile</h1> <h2 id="简介-2"><a href="#简介-2" class="header-anchor">#</a> 简介</h2> <p><img src="/TechnicalNotes/assets/img/kuangstudybd744e77-1e24-41e0-9737-d169690f30cf.16ae7442.png" alt="img"></p> <p>Dockerfile 是用来构建 Docker 镜像的文件，可以理解为<strong>命令参数脚本</strong>。</p> <p>Dockerfile 是面向开发的，想要打包项目，就要编写 Dockerfile 文件。</p> <blockquote><p>由于 Docker 的流行，Docker 镜像逐渐替代 <strong>jar</strong> 或者 <strong>war</strong> 成为企业的交付标准。</p></blockquote> <h2 id="官方-dockerfile"><a href="#官方-dockerfile" class="header-anchor">#</a> 官方 Dockerfile</h2> <blockquote><p>首先看一下官方的 Dockerfile。</p></blockquote> <p>这里以 centos 的镜像为例。</p> <blockquote><p>在 <a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">Docker Hub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 搜索 centos 镜像，选择官方镜像。</p></blockquote> <p><img src="/TechnicalNotes/assets/img/kuangstudy07af1e35-15eb-4529-8d12-ef5ea0c1ea8e.c87fefc3.png" alt="img"></p> <blockquote><p>点击 <strong>The CentOS Project</strong> 。</p></blockquote> <p><img src="/TechnicalNotes/assets/img/kuangstudyaa509032-be45-4ece-ad06-ab89df41112f.7acb5cf3.png" alt="img"></p> <blockquote><p>选择版本分支。这里以 <strong>CentOS-7.6.1810</strong> 为例。</p></blockquote> <p><img src="/TechnicalNotes/assets/img/kuangstudyb7697c68-22ef-4905-9170-62378aef5f0b.47261c5c.png" alt="img"></p> <blockquote><p>查看 Dockerfile。</p></blockquote> <p><img src="/TechnicalNotes/assets/img/kuangstudy55cc0f0a-1230-46df-a5dc-771be68096e0.06edc09d.png" alt="img"></p> <p><img src="/TechnicalNotes/assets/img/kuangstudy62bf47da-a420-4fd3-90db-035c70d5280c.81748600.png" alt="img"></p> <blockquote><p>可以看出官方的 Dockerfile 是很简洁的，这就是 Docker 极致精简的原因。</p></blockquote> <p>不过，官方镜像都是基础包，很多功能是没有的，比如 centos 的官方镜像是没有 <code>vim</code> 命令的。</p> <p>像这种基础命令比较常用，如果想要使用可以在容器内安装，但这样很不方便，因为每个新启动的容器都要安装。</p> <p>我们通常会选择自己搭建镜像，这就要用到 Dockerfile 了。</p> <h2 id="命令-2"><a href="#命令-2" class="header-anchor">#</a> 命令</h2> <p>以上面的 centos 官方镜像的 Dockerfile 为例。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>FROM scratch
ADD centos-7-docker.tar.xz /
LABEL org.label-schema.schema-version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span> <span class="token punctuation">\</span>
    org.label-schema.name<span class="token operator">=</span><span class="token string">&quot;CentOS Base Image&quot;</span> <span class="token punctuation">\</span>
    org.label-schema.vendor<span class="token operator">=</span><span class="token string">&quot;CentOS&quot;</span> <span class="token punctuation">\</span>
    org.label-schema.license<span class="token operator">=</span><span class="token string">&quot;GPLv2&quot;</span> <span class="token punctuation">\</span>
    org.label-schema.build-date<span class="token operator">=</span><span class="token string">&quot;20181204&quot;</span>
CMD <span class="token punctuation">[</span><span class="token string">&quot;/bin/bash&quot;</span><span class="token punctuation">]</span>
</code></pre></div><p>Docker Hub 中 99% 的镜像都是从<code>FROM scratch</code> 开始的。</p> <blockquote><p>规则</p></blockquote> <ul><li>每个指令都必须是大写字母。</li> <li>按照从上到下顺序执行。</li> <li><strong>#</strong> 表示注释。</li> <li>每一条指令都会创建一个新的镜像层。</li></ul> <blockquote><p>解释</p></blockquote> <ul><li><code>FROM</code>：基础镜像，比如 centos。</li> <li><code>MAINTAINER</code>：镜像是谁写的。建议以此格式：<code>姓名&lt;邮箱&gt;</code>。</li> <li><code>RUN</code>：镜像构建时需要运行的命令。</li> <li><code>ADD</code>：添加，比如添加一个 tomcat 压缩包。</li> <li><code>WORKDIR</code>：镜像的工作目录。</li> <li><code>VOLUME</code>：挂载的目录。</li> <li><code>EXPOSE</code>：指定暴露端口，跟 -p 一个道理。</li> <li><code>RUN</code>：最终要运行的。</li> <li><code>CMD</code>：指定这个容器启动的时候要运行的命令，只有最后一个会生效，而且可被替代。</li> <li><code>ENTRYPOINT</code>：指定这个容器启动的时候要运行的命令，可以追加命令。</li> <li><code>ONBUILD</code>：当构建一个被继承Dockerfile 这个时候运行ONBUILD指定，触发指令。</li> <li><code>COPY</code>：将文件拷贝到镜像中。</li> <li><code>ENV</code>：构建的时候设置环境变量。</li></ul> <h3 id="构建镜像"><a href="#构建镜像" class="header-anchor">#</a> 构建镜像</h3> <h4 id="docker-build"><a href="#docker-build" class="header-anchor">#</a> docker build</h4> <p>Dockerfile 编写好后，需要使用 <code>docker build</code> 命令运行。</p> <blockquote><p>语法</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>docker build [参数] 路径 | 网络地址 | -
</code></pre></div><blockquote><p>参数</p></blockquote> <ul><li><code>-f</code>：指定要使用的Dockerfile路径。</li> <li><code>-t</code>：镜像的名字及标签，通常 <strong>name:tag</strong> 或者 <strong>name</strong> 格式；可以在一次构建中为一个镜像设置多个标签。</li> <li><code>-m</code>：设置内存最大值。</li></ul> <blockquote><p>Docker 守护进程执行 Dockerfile 中的指令前，首先会对 Dockerfile 进行语法检查，有语法错误时会返回报错信息。</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code>Error response from daemon: Unknown instruction: RUNCMD
</code></pre></div><h3 id="查看构建记录"><a href="#查看构建记录" class="header-anchor">#</a> 查看构建记录</h3> <h4 id="docker-history"><a href="#docker-history" class="header-anchor">#</a> docker history</h4> <blockquote><p>语法</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>docker history 镜像
</code></pre></div><h3 id="cmd-与-entrypoint-区别"><a href="#cmd-与-entrypoint-区别" class="header-anchor">#</a> CMD 与 ENTRYPOINT 区别</h3> <h4 id="cmd-命令演示"><a href="#cmd-命令演示" class="header-anchor">#</a> CMD 命令演示</h4> <blockquote><p>编写 Dockerfile</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs dockerfile<span class="token punctuation">]</span><span class="token comment"># vim Dockerfile-cmd-test</span>
<span class="token punctuation">[</span>root@qzs dockerfile<span class="token punctuation">]</span><span class="token comment"># cat Dockerfile-cmd-test </span>
FROM centos
CMD <span class="token punctuation">[</span><span class="token string">&quot;ls&quot;</span>,<span class="token string">&quot;-a&quot;</span><span class="token punctuation">]</span>
</code></pre></div><blockquote><p>构建镜像</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs dockerfile<span class="token punctuation">]</span><span class="token comment"># docker build -f Dockerfile-cmd-test -t cmdtest .</span>
Sending build context to Docker daemon  <span class="token number">2</span>.048kB
Step <span class="token number">1</span>/2 <span class="token builtin class-name">:</span> FROM centos
 ---<span class="token operator">&gt;</span> 5d0da3dc9764
Step <span class="token number">2</span>/2 <span class="token builtin class-name">:</span> CMD <span class="token punctuation">[</span><span class="token string">&quot;ls&quot;</span>,<span class="token string">&quot;-a&quot;</span><span class="token punctuation">]</span>
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> 0a743e929fff
Removing intermediate container 0a743e929fff
 ---<span class="token operator">&gt;</span> 1683c0790d49
Successfully built 1683c0790d49
Successfully tagged cmdtest:latest
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs dockerfile<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY        TAG       IMAGE ID       CREATED          SIZE
cmdtest           latest    1683c0790d49   <span class="token number">13</span> minutes ago   231MB
</code></pre></div><blockquote><p>运行镜像</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs dockerfile<span class="token punctuation">]</span><span class="token comment"># docker run cmdtest</span>
<span class="token builtin class-name">.</span>
<span class="token punctuation">..</span>
.dockerenv
bin
dev
etc
home
lib
lib64
lost+found
media
mnt
opt
proc
root
run
sbin
srv
sys
tmp
usr
var
</code></pre></div><p>此时 Dockerfile 中编写的命令生效了。</p> <blockquote><p>追加 <code>-l</code> 命令</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs dockerfile<span class="token punctuation">]</span><span class="token comment"># docker run cmdtest -l</span>
docker: Error response from daemon: OCI runtime create failed: container_linux.go:380: starting container process caused: exec: <span class="token string">&quot;-l&quot;</span><span class="token builtin class-name">:</span> executable <span class="token function">file</span> not found <span class="token keyword">in</span> <span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span> unknown.
ERRO<span class="token punctuation">[</span>0000<span class="token punctuation">]</span> error waiting <span class="token keyword">for</span> container: context canceled
</code></pre></div><p>没有达到预期的 <code>ls -al</code> 命令。</p> <blockquote><p><code>CMD</code> 是<strong>替换</strong>的方式， <code>-l</code> 不是命令，所以报错。</p></blockquote> <h4 id="entrypoint-命令演示"><a href="#entrypoint-命令演示" class="header-anchor">#</a> ENTRYPOINT 命令演示</h4> <blockquote><p>编写 Dockerfile</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>[root@qzs dockerfile]# vim Dockerfile-entrypoint-test
[root@qzs dockerfile]# cat Dockerfile-entrypoint-test 
FROM centos
ENTRYPOINT [&quot;ls&quot;,&quot;-a&quot;]
</code></pre></div><blockquote><p>构建镜像</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs dockerfile<span class="token punctuation">]</span><span class="token comment"># docker build -f Dockerfile-entrypoint-test -t entrypoint-test .</span>
Sending build context to Docker daemon  <span class="token number">3</span>.072kB
Step <span class="token number">1</span>/2 <span class="token builtin class-name">:</span> FROM centos
 ---<span class="token operator">&gt;</span> 5d0da3dc9764
Step <span class="token number">2</span>/2 <span class="token builtin class-name">:</span> ENTRYPOINT <span class="token punctuation">[</span><span class="token string">&quot;ls&quot;</span>,<span class="token string">&quot;-a&quot;</span><span class="token punctuation">]</span>
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> a02d55ae0a00
Removing intermediate container a02d55ae0a00
 ---<span class="token operator">&gt;</span> 795973a0ed43
Successfully built 795973a0ed43
Successfully tagged entrypoint-test:latest
</code></pre></div><blockquote><p>运行镜像</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs dockerfile<span class="token punctuation">]</span><span class="token comment"># docker run entrypoint-test</span>
<span class="token builtin class-name">.</span>
<span class="token punctuation">..</span>
.dockerenv
bin
dev
etc
home
lib
lib64
lost+found
media
mnt
opt
proc
root
run
sbin
srv
sys
tmp
usr
var
</code></pre></div><p>此时 Dockerfile 中编写的命令也生效了。</p> <blockquote><p>追加 <code>-l</code> 命令</p></blockquote> <div class="language-sehll extra-class"><pre class="language-text"><code>[root@qzs dockerfile]# docker run entrypoint-test -l
total 56
drwxr-xr-x   1 root root 4096 Dec 23 06:46 .
drwxr-xr-x   1 root root 4096 Dec 23 06:46 ..
-rwxr-xr-x   1 root root    0 Dec 23 06:46 .dockerenv
lrwxrwxrwx   1 root root    7 Nov  3  2020 bin -&gt; usr/bin
drwxr-xr-x   5 root root  340 Dec 23 06:46 dev
drwxr-xr-x   1 root root 4096 Dec 23 06:46 etc
drwxr-xr-x   2 root root 4096 Nov  3  2020 home
lrwxrwxrwx   1 root root    7 Nov  3  2020 lib -&gt; usr/lib
lrwxrwxrwx   1 root root    9 Nov  3  2020 lib64 -&gt; usr/lib64
drwx------   2 root root 4096 Sep 15 14:17 lost+found
drwxr-xr-x   2 root root 4096 Nov  3  2020 media
drwxr-xr-x   2 root root 4096 Nov  3  2020 mnt
drwxr-xr-x   2 root root 4096 Nov  3  2020 opt
dr-xr-xr-x 106 root root    0 Dec 23 06:46 proc
dr-xr-x---   2 root root 4096 Sep 15 14:17 root
drwxr-xr-x  11 root root 4096 Sep 15 14:17 run
lrwxrwxrwx   1 root root    8 Nov  3  2020 sbin -&gt; usr/sbin
drwxr-xr-x   2 root root 4096 Nov  3  2020 srv
dr-xr-xr-x  13 root root    0 Oct 31 15:00 sys
drwxrwxrwt   7 root root 4096 Sep 15 14:17 tmp
drwxr-xr-x  12 root root 4096 Sep 15 14:17 usr
drwxr-xr-x  20 root root 4096 Sep 15 14:17 var
</code></pre></div><p>运行了预期的 <code>ls -al</code> 命令。</p> <blockquote><p><code>ENTRYPOINT</code> 是<strong>追加</strong>的方式。</p></blockquote> <p>Docker 中许多命令都十分相似，我们需要了解他们的区别，最好的方式就是这样对比测试。</p> <h2 id="实战-2"><a href="#实战-2" class="header-anchor">#</a> 实战</h2> <h3 id="创建包含vim命令的centos镜像"><a href="#创建包含vim命令的centos镜像" class="header-anchor">#</a> 创建包含vim命令的centos镜像</h3> <blockquote><p>编写 Dockerfile</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs dockerfile<span class="token punctuation">]</span><span class="token comment"># vim Dockerfile-centos-test </span>
<span class="token punctuation">[</span>root@qzs dockerfile<span class="token punctuation">]</span><span class="token comment"># cat Dockerfile-centos-test </span>
FROM centos
MAINTAINER qzs<span class="token operator">&lt;</span><span class="token number">283408112</span>@qq.com<span class="token operator">&gt;</span>
ENV MYPATH /usr/local
WORKDIR <span class="token variable">$MYPATH</span>
RUN yum -y <span class="token function">install</span> <span class="token function">vim</span>
RUN yum -y <span class="token function">install</span> net-tools
EXPOSE <span class="token number">81</span>
CMD <span class="token builtin class-name">echo</span> <span class="token variable">$MYPATH</span>
CMD <span class="token builtin class-name">echo</span> <span class="token string">&quot;---end---&quot;</span>
CMD <span class="token punctuation">[</span><span class="token string">&quot;/bin/bash&quot;</span><span class="token punctuation">]</span>
</code></pre></div><blockquote><p>构建镜像</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs dockerfile<span class="token punctuation">]</span><span class="token comment"># docker build -f Dockerfile-centos-test -t centos-test .</span>
Sending build context to Docker daemon  <span class="token number">5</span>.632kB
Step <span class="token number">1</span>/10 <span class="token builtin class-name">:</span> FROM centos
 ---<span class="token operator">&gt;</span> 5d0da3dc9764
Step <span class="token number">2</span>/10 <span class="token builtin class-name">:</span> MAINTAINER sail<span class="token operator">&lt;</span>yifansailing@163.com<span class="token operator">&gt;</span>
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> 8b7340768878
Removing intermediate container 8b7340768878
 ---<span class="token operator">&gt;</span> 9616888f3b10
Step <span class="token number">3</span>/10 <span class="token builtin class-name">:</span> ENV MYPATH /usr/local
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> 2c73446a56ff
Removing intermediate container 2c73446a56ff
 ---<span class="token operator">&gt;</span> be89377d4c2c
Step <span class="token number">4</span>/10 <span class="token builtin class-name">:</span> WORKDIR <span class="token variable">$MYPATH</span>
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> db113c4f7cb2
Removing intermediate container db113c4f7cb2
 ---<span class="token operator">&gt;</span> fb41ece5d944
Step <span class="token number">5</span>/10 <span class="token builtin class-name">:</span> RUN yum -y <span class="token function">install</span> <span class="token function">vim</span>
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> eccee60c0389
CentOS Linux <span class="token number">8</span> - AppStream                       <span class="token number">12</span> MB/s <span class="token operator">|</span> <span class="token number">8.4</span> MB     00:00    
CentOS Linux <span class="token number">8</span> - BaseOS                         <span class="token number">1.7</span> MB/s <span class="token operator">|</span> <span class="token number">3.6</span> MB     00:02    
CentOS Linux <span class="token number">8</span> - Extras                          <span class="token number">17</span> kB/s <span class="token operator">|</span>  <span class="token number">10</span> kB     00:00    
Last metadata expiration check: <span class="token number">0</span>:00:01 ago on Sat Dec <span class="token number">25</span> 05:09:40 <span class="token number">2021</span>.
Dependencies resolved.
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
 Package             Arch        Version                   Repository      Size
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
Installing:
 vim-enhanced        x86_64      <span class="token number">2</span>:8.0.1763-16.el8         appstream      <span class="token number">1.4</span> M
Installing dependencies:
 gpm-libs            x86_64      <span class="token number">1.20</span>.7-17.el8             appstream       <span class="token number">39</span> k
 vim-common          x86_64      <span class="token number">2</span>:8.0.1763-16.el8         appstream      <span class="token number">6.3</span> M
 vim-filesystem      noarch      <span class="token number">2</span>:8.0.1763-16.el8         appstream       <span class="token number">49</span> k
 <span class="token function">which</span>               x86_64      <span class="token number">2.21</span>-16.el8               baseos          <span class="token number">49</span> k
Transaction Summary
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
Install  <span class="token number">5</span> Packages
Total download size: <span class="token number">7.8</span> M
Installed size: <span class="token number">30</span> M
Downloading Packages:
<span class="token punctuation">(</span><span class="token number">1</span>/5<span class="token punctuation">)</span>: gpm-libs-1.20.7-17.el8.x86_64.rpm        <span class="token number">582</span> kB/s <span class="token operator">|</span>  <span class="token number">39</span> kB     00:00    
<span class="token punctuation">(</span><span class="token number">2</span>/5<span class="token punctuation">)</span>: vim-filesystem-8.0.1763-16.el8.noarch.rp <span class="token number">1.2</span> MB/s <span class="token operator">|</span>  <span class="token number">49</span> kB     00:00    
<span class="token punctuation">(</span><span class="token number">3</span>/5<span class="token punctuation">)</span>: vim-common-8.0.1763-16.el8.x86_64.rpm     <span class="token number">40</span> MB/s <span class="token operator">|</span> <span class="token number">6.3</span> MB     00:00    
<span class="token punctuation">(</span><span class="token number">4</span>/5<span class="token punctuation">)</span>: vim-enhanced-8.0.1763-16.el8.x86_64.rpm  <span class="token number">7.1</span> MB/s <span class="token operator">|</span> <span class="token number">1.4</span> MB     00:00    
<span class="token punctuation">(</span><span class="token number">5</span>/5<span class="token punctuation">)</span>: which-2.21-16.el8.x86_64.rpm             <span class="token number">252</span> kB/s <span class="token operator">|</span>  <span class="token number">49</span> kB     00:00    
--------------------------------------------------------------------------------
Total                                           <span class="token number">6.4</span> MB/s <span class="token operator">|</span> <span class="token number">7.8</span> MB     00:01     
warning: /var/cache/dnf/appstream-02e86d1c976ab532/packages/gpm-libs-1.20.7-17.el8.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID 8483c65d: NOKEY
CentOS Linux <span class="token number">8</span> - AppStream                      <span class="token number">1.6</span> MB/s <span class="token operator">|</span> <span class="token number">1.6</span> kB     00:00    
Importing GPG key 0x8483C65D:
 Userid     <span class="token builtin class-name">:</span> <span class="token string">&quot;CentOS (CentOS Official Signing Key) &lt;security@centos.org&gt;&quot;</span>
 Fingerprint: 99DB 70FA E1D7 CE22 7FB6 <span class="token number">4882</span> 05B5 55B3 <span class="token number">8483</span> C65D
 From       <span class="token builtin class-name">:</span> /etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial
Key imported successfully
Running transaction check
Transaction check succeeded.
Running transaction <span class="token builtin class-name">test</span>
Transaction <span class="token builtin class-name">test</span> succeeded.
Running transaction
  Preparing        <span class="token builtin class-name">:</span>                                                        <span class="token number">1</span>/1 
  Installing       <span class="token builtin class-name">:</span> which-2.21-16.el8.x86_64                               <span class="token number">1</span>/5 
  Installing       <span class="token builtin class-name">:</span> vim-filesystem-2:8.0.1763-16.el8.noarch                <span class="token number">2</span>/5 
  Installing       <span class="token builtin class-name">:</span> vim-common-2:8.0.1763-16.el8.x86_64                    <span class="token number">3</span>/5 
  Installing       <span class="token builtin class-name">:</span> gpm-libs-1.20.7-17.el8.x86_64                          <span class="token number">4</span>/5 
  Running scriptlet: gpm-libs-1.20.7-17.el8.x86_64                          <span class="token number">4</span>/5 
  Installing       <span class="token builtin class-name">:</span> vim-enhanced-2:8.0.1763-16.el8.x86_64                  <span class="token number">5</span>/5 
  Running scriptlet: vim-enhanced-2:8.0.1763-16.el8.x86_64                  <span class="token number">5</span>/5 
  Running scriptlet: vim-common-2:8.0.1763-16.el8.x86_64                    <span class="token number">5</span>/5 
  Verifying        <span class="token builtin class-name">:</span> gpm-libs-1.20.7-17.el8.x86_64                          <span class="token number">1</span>/5 
  Verifying        <span class="token builtin class-name">:</span> vim-common-2:8.0.1763-16.el8.x86_64                    <span class="token number">2</span>/5 
  Verifying        <span class="token builtin class-name">:</span> vim-enhanced-2:8.0.1763-16.el8.x86_64                  <span class="token number">3</span>/5 
  Verifying        <span class="token builtin class-name">:</span> vim-filesystem-2:8.0.1763-16.el8.noarch                <span class="token number">4</span>/5 
  Verifying        <span class="token builtin class-name">:</span> which-2.21-16.el8.x86_64                               <span class="token number">5</span>/5 
Installed:
  gpm-libs-1.20.7-17.el8.x86_64         vim-common-2:8.0.1763-16.el8.x86_64    
  vim-enhanced-2:8.0.1763-16.el8.x86_64 vim-filesystem-2:8.0.1763-16.el8.noarch
  which-2.21-16.el8.x86_64             
Complete<span class="token operator">!</span>
Removing intermediate container eccee60c0389
 ---<span class="token operator">&gt;</span> 9f54f48660ac
Step <span class="token number">6</span>/10 <span class="token builtin class-name">:</span> RUN yum -y <span class="token function">install</span> net-tools
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> 6caa7361b001
Last metadata expiration check: <span class="token number">0</span>:00:08 ago on Sat Dec <span class="token number">25</span> 05:09:40 <span class="token number">2021</span>.
Dependencies resolved.
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
 Package         Architecture Version                        Repository    Size
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
Installing:
 net-tools       x86_64       <span class="token number">2.0</span>-0.52.20160912git.el8       baseos       <span class="token number">322</span> k
Transaction Summary
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
Install  <span class="token number">1</span> Package
Total download size: <span class="token number">322</span> k
Installed size: <span class="token number">942</span> k
Downloading Packages:
net-tools-2.0-0.52.20160912git.el8.x86_64.rpm   <span class="token number">1.0</span> MB/s <span class="token operator">|</span> <span class="token number">322</span> kB     00:00    
--------------------------------------------------------------------------------
Total                                           <span class="token number">449</span> kB/s <span class="token operator">|</span> <span class="token number">322</span> kB     00:00     
Running transaction check
Transaction check succeeded.
Running transaction <span class="token builtin class-name">test</span>
Transaction <span class="token builtin class-name">test</span> succeeded.
Running transaction
  Preparing        <span class="token builtin class-name">:</span>                                                        <span class="token number">1</span>/1 
  Installing       <span class="token builtin class-name">:</span> net-tools-2.0-0.52.20160912git.el8.x86_64              <span class="token number">1</span>/1 
  Running scriptlet: net-tools-2.0-0.52.20160912git.el8.x86_64              <span class="token number">1</span>/1 
  Verifying        <span class="token builtin class-name">:</span> net-tools-2.0-0.52.20160912git.el8.x86_64              <span class="token number">1</span>/1 
Installed:
  net-tools-2.0-0.52.20160912git.el8.x86_64                                     
Complete<span class="token operator">!</span>
Removing intermediate container 6caa7361b001
 ---<span class="token operator">&gt;</span> a9431f90fd3f
Step <span class="token number">7</span>/10 <span class="token builtin class-name">:</span> EXPOSE <span class="token number">81</span>
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> ad67fa23940a
Removing intermediate container ad67fa23940a
 ---<span class="token operator">&gt;</span> b5bd21416741
Step <span class="token number">8</span>/10 <span class="token builtin class-name">:</span> CMD <span class="token builtin class-name">echo</span> <span class="token variable">$MYPATH</span>
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> fb1d08538689
Removing intermediate container fb1d08538689
 ---<span class="token operator">&gt;</span> 5c5def0bbb85
Step <span class="token number">9</span>/10 <span class="token builtin class-name">:</span> CMD <span class="token builtin class-name">echo</span> <span class="token string">&quot;---end---&quot;</span>
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> a9d955b6b389
Removing intermediate container a9d955b6b389
 ---<span class="token operator">&gt;</span> ad95558eb658
Step <span class="token number">10</span>/10 <span class="token builtin class-name">:</span> CMD <span class="token punctuation">[</span><span class="token string">&quot;/bin/bash&quot;</span><span class="token punctuation">]</span>
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> 190651202e7b
Removing intermediate container 190651202e7b
 ---<span class="token operator">&gt;</span> d58be7785771
Successfully built d58be7785771
Successfully tagged centos-test:latest
</code></pre></div><blockquote><p>查看构建的镜像</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs dockerfile<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY        TAG       IMAGE ID       CREATED              SIZE
centos-test       latest    d58be7785771   About a minute ago   323MB
</code></pre></div><blockquote><p>查看本地镜像的构建记录</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>[root@qzs dockerfile]# docker history centos-test
IMAGE          CREATED         CREATED BY                                      SIZE      COMMENT
d58be7785771   5 minutes ago   /bin/sh -c #(nop)  CMD [&quot;/bin/bash&quot;]            0B        
ad95558eb658   5 minutes ago   /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;echo…   0B        
5c5def0bbb85   5 minutes ago   /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;echo…   0B        
b5bd21416741   5 minutes ago   /bin/sh -c #(nop)  EXPOSE 81                    0B        
a9431f90fd3f   5 minutes ago   /bin/sh -c yum -y install net-tools             27.3MB    
9f54f48660ac   5 minutes ago   /bin/sh -c yum -y install vim                   64.8MB    
fb41ece5d944   5 minutes ago   /bin/sh -c #(nop) WORKDIR /usr/local            0B        
be89377d4c2c   5 minutes ago   /bin/sh -c #(nop)  ENV MYPATH=/usr/local        0B        
9616888f3b10   5 minutes ago   /bin/sh -c #(nop)  MAINTAINER sail&lt;yifansail…   0B        
5d0da3dc9764   3 months ago    /bin/sh -c #(nop)  CMD [&quot;/bin/bash&quot;]            0B        
&lt;missing&gt;      3 months ago    /bin/sh -c #(nop)  LABEL org.label-schema.sc…   0B        
&lt;missing&gt;      3 months ago    /bin/sh -c #(nop) ADD file:805cb5e15fb6e0bb0…   231MB
</code></pre></div><blockquote><p>运行测试</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs ~<span class="token punctuation">]</span><span class="token comment"># docker run -it centos-test</span>
<span class="token punctuation">[</span>root@530551bc2162 local<span class="token punctuation">]</span><span class="token comment"># pwd</span>
/usr/local
<span class="token punctuation">[</span>root@530551bc2162 local<span class="token punctuation">]</span><span class="token comment"># vim test.java</span>
<span class="token punctuation">[</span>root@530551bc2162 local<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre></div><p>默认的工作目录正是 Dockerfile 中设置的 <code>/usr/local</code> ，且可以使用 <code>vim</code> 命令了。</p> <h3 id="自定义tomcat环境镜像"><a href="#自定义tomcat环境镜像" class="header-anchor">#</a> 自定义tomcat环境镜像</h3> <blockquote><p>编写 Dockerfile</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code>FROM centos
MAINTAINER qzs<span class="token operator">&lt;</span><span class="token number">283408112</span>@qq.com<span class="token operator">&gt;</span>
COPY readme.txt /usr/local/readme.txt
ENV MYPATH /usr/local/
WORKDIR <span class="token variable">$MYPATH</span>
ADD jdk-8u301-linux-x64.tar.gz <span class="token variable">$MYPATH</span>
ADD apache-tomcat-9.0.55.tar.gz <span class="token variable">$MYPATH</span>
RUN yum -y <span class="token function">install</span> <span class="token function">vim</span>
ENV JAVA_HOME <span class="token variable">$MYPATH</span>/jdk1.8.0_301-amd64
ENV CLASSPATH <span class="token variable">$JAVA_HOME</span>/lib/
ENV CATALINA_HOME <span class="token variable">$MYPATH</span>/apache-tomcat-9.0.55
ENV CATALINA_BASH <span class="token variable">$MYPATH</span>/apache-tomcat-9.0.55
ENV <span class="token environment constant">PATH</span> <span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$JAVA_HOME</span>/bin:<span class="token variable">$CATALINA_HOME</span>/bin:<span class="token variable">$CATALINA_HOME</span>/lib
EXPOSE <span class="token number">8080</span>
CMD <span class="token variable">$CATALINA_HOME</span>/bin/startup.sh <span class="token operator">&amp;&amp;</span> <span class="token function">tail</span> -F <span class="token variable">$CATALINA_HOME</span>/logs/catalina.out
</code></pre></div><p>其中的 <strong>readme.txt</strong> 一般作为镜像说明文件，可以在里面编写镜像的信息。</p> <blockquote><p>构建镜像</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>[root@qzs tomcat]# docker build -t tomcat-test .
Sending build context to Docker daemon  157.1MB
Step 1/15 : FROM centos
 ---&gt; 5d0da3dc9764
Step 2/15 : MAINTAINER sail&lt;yifansailing@163.com&gt;
 ---&gt; Using cache
 ---&gt; 9616888f3b10
Step 3/15 : COPY readme.txt /usr/local/readme.txt
 ---&gt; da792df641f8
Step 4/15 : ENV MYPATH /usr/local/
 ---&gt; Running in e4a5b13decd7
Removing intermediate container e4a5b13decd7
 ---&gt; 7b1e6970b4b3
Step 5/15 : WORKDIR $MYPATH
 ---&gt; Running in 835dabd080dd
Removing intermediate container 835dabd080dd
 ---&gt; 7be17b1556ee
Step 6/15 : ADD jdk-8u301-linux-x64.tar.gz $MYPATH
 ---&gt; 480721043fda
Step 7/15 : ADD apache-tomcat-9.0.55.tar.gz $MYPATH
 ---&gt; c7bfa13bfcd1
Step 8/15 : RUN yum -y install vim
 ---&gt; Running in 85532523d784
CentOS Linux 8 - AppStream                      9.0 MB/s | 8.4 MB     00:00    
CentOS Linux 8 - BaseOS                         5.6 MB/s | 3.6 MB     00:00    
CentOS Linux 8 - Extras                          20 kB/s |  10 kB     00:00    
Dependencies resolved.
================================================================================
 Package             Arch        Version                   Repository      Size
================================================================================
Installing:
 vim-enhanced        x86_64      2:8.0.1763-16.el8         appstream      1.4 M
Installing dependencies:
 gpm-libs            x86_64      1.20.7-17.el8             appstream       39 k
 vim-common          x86_64      2:8.0.1763-16.el8         appstream      6.3 M
 vim-filesystem      noarch      2:8.0.1763-16.el8         appstream       49 k
 which               x86_64      2.21-16.el8               baseos          49 k
Transaction Summary
================================================================================
Install  5 Packages
Total download size: 7.8 M
Installed size: 30 M
Downloading Packages:
(1/5): gpm-libs-1.20.7-17.el8.x86_64.rpm        973 kB/s |  39 kB     00:00    
(2/5): vim-filesystem-8.0.1763-16.el8.noarch.rp 726 kB/s |  49 kB     00:00    
(3/5): vim-enhanced-8.0.1763-16.el8.x86_64.rpm   10 MB/s | 1.4 MB     00:00    
(4/5): which-2.21-16.el8.x86_64.rpm             901 kB/s |  49 kB     00:00    
(5/5): vim-common-8.0.1763-16.el8.x86_64.rpm     27 MB/s | 6.3 MB     00:00    
--------------------------------------------------------------------------------
Total                                           6.6 MB/s | 7.8 MB     00:01     
warning: /var/cache/dnf/appstream-02e86d1c976ab532/packages/gpm-libs-1.20.7-17.el8.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID 8483c65d: NOKEY
CentOS Linux 8 - AppStream                      1.6 MB/s | 1.6 kB     00:00    
Importing GPG key 0x8483C65D:
 Userid     : &quot;CentOS (CentOS Official Signing Key) &lt;security@centos.org&gt;&quot;
 Fingerprint: 99DB 70FA E1D7 CE22 7FB6 4882 05B5 55B3 8483 C65D
 From       : /etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial
Key imported successfully
Running transaction check
Transaction check succeeded.
Running transaction test
Transaction test succeeded.
Running transaction
  Preparing        :                                                        1/1 
  Installing       : which-2.21-16.el8.x86_64                               1/5 
  Installing       : vim-filesystem-2:8.0.1763-16.el8.noarch                2/5 
  Installing       : vim-common-2:8.0.1763-16.el8.x86_64                    3/5 
  Installing       : gpm-libs-1.20.7-17.el8.x86_64                          4/5 
  Running scriptlet: gpm-libs-1.20.7-17.el8.x86_64                          4/5 
  Installing       : vim-enhanced-2:8.0.1763-16.el8.x86_64                  5/5 
  Running scriptlet: vim-enhanced-2:8.0.1763-16.el8.x86_64                  5/5 
  Running scriptlet: vim-common-2:8.0.1763-16.el8.x86_64                    5/5 
  Verifying        : gpm-libs-1.20.7-17.el8.x86_64                          1/5 
  Verifying        : vim-common-2:8.0.1763-16.el8.x86_64                    2/5 
  Verifying        : vim-enhanced-2:8.0.1763-16.el8.x86_64                  3/5 
  Verifying        : vim-filesystem-2:8.0.1763-16.el8.noarch                4/5 
  Verifying        : which-2.21-16.el8.x86_64                               5/5 
Installed:
  gpm-libs-1.20.7-17.el8.x86_64         vim-common-2:8.0.1763-16.el8.x86_64    
  vim-enhanced-2:8.0.1763-16.el8.x86_64 vim-filesystem-2:8.0.1763-16.el8.noarch
  which-2.21-16.el8.x86_64             
Complete!
Removing intermediate container 85532523d784
 ---&gt; e091ece0364d
Step 9/15 : ENV JAVA_HOME $MYPATH/jdk1.8.0_301-amd64
 ---&gt; Running in 473066cf57f4
Removing intermediate container 473066cf57f4
 ---&gt; 0a8963a2c1ab
Step 10/15 : ENV CLASSPATH $JAVA_HOME/lib/
 ---&gt; Running in 78a2cb9b06cd
Removing intermediate container 78a2cb9b06cd
 ---&gt; 3dd34a2857b4
Step 11/15 : ENV CATALINA_HOME $MYPATH/apache-tomcat-9.0.55
 ---&gt; Running in 4ca540479e3d
Removing intermediate container 4ca540479e3d
 ---&gt; fa38f4581510
Step 12/15 : ENV CATALINA_BASH $MYPATH/apache-tomcat-9.0.55
 ---&gt; Running in 31dc5b38478c
Removing intermediate container 31dc5b38478c
 ---&gt; 8ae919106bf6
Step 13/15 : ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/bin:$CATALINA_HOME/lib
 ---&gt; Running in d3fe1f81fab7
Removing intermediate container d3fe1f81fab7
 ---&gt; dd8b07b2adfd
Step 14/15 : EXPOSE 8080
 ---&gt; Running in 1f1601f2dcc2
Removing intermediate container 1f1601f2dcc2
 ---&gt; 9078648b7a2e
Step 15/15 : CMD $CATALINA_HOME/bin/startup.sh &amp;&amp; tail -F $CATALINA_HOME/logs/catalina.out
 ---&gt; Running in 6a3b2aefaf44
Removing intermediate container 6a3b2aefaf44
 ---&gt; 23a538c107a0
Successfully built 23a538c107a0
Successfully tagged tomcat-test:latest
</code></pre></div><blockquote><p>查看镜像</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs tomcat<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY        TAG       IMAGE ID       CREATED          SIZE
tomcat-test       latest    23a538c107a0   <span class="token number">25</span> minutes ago   673MB
</code></pre></div><blockquote><p>启动镜像</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs tomcat<span class="token punctuation">]</span><span class="token comment"># docker run -d -p 8080:8080 --name sail-tomcat -v /home/sail/tomcat/webapps:/usr/local/apache-tomcat-9.0.55/webapps -v /home/sail/tomcat/logs:/usr/local/apache-tomcat-9.0.55/logs tomcat-test </span>
9d391e13efdc495206429dbdb0392180a7bd3a4750cbc1419c31c80cd69c6b7b
<span class="token punctuation">[</span>root@sail tomcat<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre></div><p>启动时将 tomcat 的 <strong>webapps</strong> 和 <strong>logs</strong> 目录都挂载到了本机。</p> <blockquote><p>查看挂载目录</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs tomcat<span class="token punctuation">]</span><span class="token comment"># ls /home/sail/tomcat</span>
logs  webapps
</code></pre></div><p>这里找到了挂载到本机的两个目录，说明挂载成功了。</p> <blockquote><p>进入容器</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs tomcat<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE         COMMAND                  CREATED          STATUS          PORTS                    NAMES
9d391e13efdc   tomcat-test   <span class="token string">&quot;/bin/sh -c '<span class="token variable">$CATALI</span>…&quot;</span>   <span class="token number">24</span> minutes ago   Up <span class="token number">24</span> minutes   <span class="token number">0.0</span>.0.0:8080-<span class="token operator">&gt;</span><span class="token number">8080</span>/tcp   sail-tomcat

<span class="token punctuation">[</span>root@sail tomcat<span class="token punctuation">]</span><span class="token comment"># docker exec -it 9d391e13efdc /bin/bash</span>
<span class="token punctuation">[</span>root@9d391e13efdc local<span class="token punctuation">]</span><span class="token comment"># ls</span>
apache-tomcat-9.0.55  bin  etc    games  include    jdk1.8.0_301  lib  lib64  libexec  readme.txt  sbin  share  src


<span class="token punctuation">[</span>root@9d391e13efdc local<span class="token punctuation">]</span><span class="token comment"># cd apache-tomcat-9.0.55/</span>
<span class="token punctuation">[</span>root@9d391e13efdc apache-tomcat-9.0.55<span class="token punctuation">]</span><span class="token comment"># ls</span>
BUILDING.txt  CONTRIBUTING.md  LICENSE    NOTICE    README.md  RELEASE-NOTES  RUNNING.txt  bin  conf  lib  logs  temp  webapps  work
</code></pre></div><p>jdk 和 readme.txt 都是具备了的，且 tomcat 目录下的文件也是完整的。</p> <blockquote><p>查看挂载文件</p></blockquote> <p>这里以 logs 为例，我们先进入 tomcat 容器中的 logs 文件夹查看日志内容。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@9d391e13efdc apache-tomcat-9.0.55<span class="token punctuation">]</span><span class="token comment"># cd logs</span>
<span class="token punctuation">[</span>root@9d391e13efdc logs<span class="token punctuation">]</span><span class="token comment"># ls</span>
catalina.out
<span class="token punctuation">[</span>root@9d391e13efdc logs<span class="token punctuation">]</span><span class="token comment"># cat catalina.out </span>
/usr/local//apache-tomcat-9.0.55/bin/catalina.sh: line <span class="token number">504</span>: /usr/local//jdk1.8.0_301-amd64/bin/java: No such <span class="token function">file</span> or directory
</code></pre></div><p>然后再退出查看主机上挂载的 logs 文件夹。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@9d391e13efdc logs<span class="token punctuation">]</span><span class="token comment"># exit</span>
<span class="token builtin class-name">exit</span>
<span class="token punctuation">[</span>root@qzs tomcat<span class="token punctuation">]</span><span class="token comment"># cd /home/sail/tomcat/logs</span>
<span class="token punctuation">[</span>root@qzs logs<span class="token punctuation">]</span><span class="token comment"># ls</span>
catalina.out
<span class="token punctuation">[</span>root@qzs logs<span class="token punctuation">]</span><span class="token comment"># cat catalina.out </span>
/usr/local//apache-tomcat-9.0.55/bin/catalina.sh: line <span class="token number">504</span>: /usr/local//jdk1.8.0_301-amd64/bin/java: No such <span class="token function">file</span> or directory
</code></pre></div><p>两个地方 logs 下的文件内容一致，说明挂载成功。</p> <h2 id="发布镜像到-docker-hub"><a href="#发布镜像到-docker-hub" class="header-anchor">#</a> 发布镜像到 Docker Hub</h2> <blockquote><p>注册账号</p></blockquote> <p>如果没有 Docker Hub 账号，先注册账号：https://hub.docker.com/</p> <blockquote><p>登录 Docker Hub 账号</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs logs<span class="token punctuation">]</span><span class="token comment"># docker login -u 账号</span>
Password: 
WARNING<span class="token operator">!</span> Your password will be stored unencrypted <span class="token keyword">in</span> /root/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/<span class="token comment">#credentials-store</span>
Login Succeeded
</code></pre></div><h3 id="发布镜像"><a href="#发布镜像" class="header-anchor">#</a> 发布镜像</h3> <h4 id="docker-push"><a href="#docker-push" class="header-anchor">#</a> docker push</h4> <blockquote><p>直接发布镜像</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs logs<span class="token punctuation">]</span><span class="token comment"># docker push centos-test</span>
Using default tag: latest
The push refers to repository <span class="token punctuation">[</span>docker.io/library/centos-test<span class="token punctuation">]</span>
de70c523870b: Preparing 
909db45c4bc4: Preparing 
74ddd0ec08fa: Preparing 
denied: requested access to the resource is denied
</code></pre></div><p>访问资源被拒绝了。拒绝的原因是我们没有带标签，默认的 latest 标签是不能被识别的。</p> <h3 id="指定镜像标签"><a href="#指定镜像标签" class="header-anchor">#</a> 指定镜像标签</h3> <h4 id="docker-tag"><a href="#docker-tag" class="header-anchor">#</a> docker tag</h4> <p>我们可以使用 <code>docker tag</code> 命令给镜像加一个标签。</p> <blockquote><p>必须以 <code>账号名/镜像名:标签</code> 的格式命令才能提交。</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs logs<span class="token punctuation">]</span><span class="token comment"># docker tag d58be7785771 账号/centos:1.0</span>
<span class="token punctuation">[</span>root@qzs logs<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY        TAG       IMAGE ID       CREATED        SIZE
asailing/centos   <span class="token number">1.0</span>       d58be7785771   <span class="token number">29</span> hours ago   323MB
centos-test       latest    d58be7785771   <span class="token number">29</span> hours ago   323MB
</code></pre></div><p>此时会多出一个相同 ID 但是标签和名字不同的镜像。</p> <blockquote><p>再次发布镜像</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs logs<span class="token punctuation">]</span><span class="token comment"># docker push asailing/centos:1.0</span>
The push refers to repository <span class="token punctuation">[</span>docker.io/asailing/centos<span class="token punctuation">]</span>
de70c523870b: Pushed 
909db45c4bc4: Pushed 
74ddd0ec08fa: Pushed 
<span class="token number">1.0</span>: digest: sha256:ecefaae6c5a2cab84693175ea3b18d0d0a7aa0160e33a0bf3eb4ab626b10f0f1 size: <span class="token number">953</span>
</code></pre></div><p>这样就能发布成功了。且可以发现，<strong>镜像的发布也是分层发布的</strong>。</p> <h2 id="配置国内镜像站"><a href="#配置国内镜像站" class="header-anchor">#</a> 配置国内镜像站</h2> <p>由于对国外网络的限制，发布镜像到 DockerHub 是比较缓慢的。</p> <p>这里可以使用配置 <strong>Docker 国内镜像站</strong>的方式实现加速。</p> <p>运行以下命令即可：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs ~<span class="token punctuation">]</span><span class="token comment"># curl -sSL https://get.daocloud.io/daotools/set_mirror.sh | sh -s http://f1361db2.m.daocloud.io</span>
<span class="token function">docker</span> version <span class="token operator">&gt;=</span> <span class="token number">1.12</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;registry-mirrors&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;http://f1361db2.m.daocloud.io&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
Success.
You need to restart <span class="token function">docker</span> to take effect: <span class="token function">sudo</span> systemctl restart <span class="token function">docker</span>


<span class="token punctuation">[</span>root@qzs ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart docker</span>
<span class="token punctuation">[</span>root@qzs ~<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre></div><p>该脚本可以将 <code>--registry-mirror</code> 加入到 Docker 配置文件 <code>/etc/docker/daemon.json</code> 中。</p> <p>适用于 <strong>Ubuntu14.04</strong>、<strong>Debian</strong>、<strong>CentOS6</strong> 、<strong>CentOS7</strong>、<strong>Fedora</strong>、<strong>Arch Linux</strong>、<strong>openSUSE Leap 42.1</strong>，其他版本可能有细微不同。</p> <blockquote><p>去 Docker Hub 上以 <strong>账号名/镜像名</strong> 搜索我们刚发布的镜像，发现是可以搜索到的。</p></blockquote> <p><img src="/TechnicalNotes/assets/img/kuangstudy5d0bfcf4-7830-42d9-a019-6b3fdbf9d82c.92ad3d94.png" alt="img"></p> <blockquote><p>查看详情也可以镜像的具体信息。</p></blockquote> <p><img src="/TechnicalNotes/assets/img/kuangstudyc57c1644-bd6a-4e74-8d90-764c3a279b6c.afd36a5d.png" alt="img"></p> <p>DIGEST 的值正是刚才发布后返回值 <code>ecefaae6c5a2cab84693175ea3b18d0d0a7aa0160e33a0bf3eb4ab626b10f0f1</code> 的缩写。</p> <p>且镜像的大小是小于我们本地镜像的，说明<strong>发布的过程中也会压缩镜像</strong>。</p> <blockquote><p>拉取我们发布的镜像</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>[root@qzs logs]# docker pull 账号/centos:1.0
1.0: Pulling from asailing/centos
Digest: sha256:ecefaae6c5a2cab84693175ea3b18d0d0a7aa0160e33a0bf3eb4ab626b10f0f1
Status: Image is up to date for asailing/centos:1.0
docker.io/asailing/centos:1.0
</code></pre></div><p>无法拉取。原因很简单，因为我们本地存在了同名镜像。</p> <blockquote><p>我们先删除这个镜像再拉取</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs logs<span class="token punctuation">]</span><span class="token comment"># docker rmi -f d58be7785771</span>
Untagged: asailing/centos:1.0
Untagged: asailing/centos@sha256:ecefaae6c5a2cab84693175ea3b18d0d0a7aa0160e33a0bf3eb4ab626b10f0f1
Untagged: centos-test:latest
Untagged: sail/centos:1.0
Deleted: sha256:d58be7785771bd95d8016fa5807a486d6c50e195879eddd88cb602172fc51ffe
Deleted: sha256:ad95558eb65801f5871215837558156c5e33ba351b3b52e0a50aac045abb46c1
Deleted: sha256:5c5def0bbb85d8779d02f115c3d072fe9adb1fd07556ee8c5a130823ecf6811d
Deleted: sha256:b5bd21416741daec348f417dbea1b73001e257f1e63a5d2abddabc8554fca611
Deleted: sha256:a9431f90fd3f23387c456ad5b925dbb9531beece3eab825848db99db29c6a1fa
Deleted: sha256:9f54f48660acb350921aefab74769e51fc7917a1e1e730d3df2edd1513517c42
Deleted: sha256:fb41ece5d944c667762945fdf7275a1d267acd92fe9dc56709fc3adaca6f087f
Deleted: sha256:be89377d4c2ccea11308d8196ba53f03985882db015e01ed8b54fc114f4ba058
Deleted: sha256:9616888f3b103230ed5f378af4afc11b7ce7ed3d96653e5bd918c49152bbdf8c

<span class="token punctuation">[</span>root@qzs logs<span class="token punctuation">]</span><span class="token comment"># docker pull 账号/centos:1.0</span>
<span class="token number">1.0</span>: Pulling from asailing/centos
a1d0c7532777: Already exists 
0594d57f8468: Already exists 
9c13f720f33e: Already exists 
Digest: sha256:ecefaae6c5a2cab84693175ea3b18d0d0a7aa0160e33a0bf3eb4ab626b10f0f1
Status: Downloaded newer image <span class="token keyword">for</span> asailing/centos:1.0
docker.io/asailing/centos:1.0


<span class="token punctuation">[</span>root@qzs logs<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY        TAG       IMAGE ID       CREATED        SIZE
asailing/centos   <span class="token number">1.0</span>       d58be7785771   <span class="token number">29</span> hours ago   323MB
</code></pre></div><p>拉取成功，且大小又恢复到了之前本地的镜像大小，说明<strong>拉取的过程中也会解压镜像</strong>。</p> <blockquote><p>启动拉取的镜像</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs logs<span class="token punctuation">]</span><span class="token comment"># docker run -it asailing/centos:1.0 /bin/bash</span>
<span class="token punctuation">[</span>root@168c9e550886 local<span class="token punctuation">]</span><span class="token comment"># vim test.java</span>
<span class="token punctuation">[</span>root@168c9e550886 local<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre></div><p><code>vim</code> 命令也是可以使用的，镜像发布成功。</p> <h2 id="发布镜像到阿里云镜像仓库"><a href="#发布镜像到阿里云镜像仓库" class="header-anchor">#</a> 发布镜像到阿里云镜像仓库</h2> <blockquote><p>登录阿里云，点击<strong>我的阿里云</strong></p></blockquote> <p><img src="/TechnicalNotes/assets/img/kuangstudy42018025-d25d-4838-815f-cd683749715b.1d692718.png" alt="img"></p> <p><img src="/TechnicalNotes/assets/img/kuangstudy76398d1b-d43b-4d2c-8960-ab9c66e02182.0c82e786.png" alt="img"></p> <blockquote><p>创建实例</p></blockquote> <p>这里以创建个人版实例为例。</p> <p>我这里已经创建好了，如果没有创建点击创建即可。</p> <p><img src="/TechnicalNotes/assets/img/kuangstudyf40bb3ef-d6e3-4fcf-b2cf-56a68f3a3936.28951ad5.png" alt="img"></p> <blockquote><p>进入镜像仓库</p></blockquote> <p>创建好个人实例后，点击进入。</p> <p><img src="/TechnicalNotes/assets/img/kuangstudy599e3dcd-15a1-4996-bb6d-4c25e60a9344.1e96a941.png" alt="img"></p> <blockquote><p>创建命名空间</p></blockquote> <p><img src="/TechnicalNotes/assets/img/kuangstudycb118d7b-e673-46f3-8fc8-963b8a26a5d8.a34a1910.png" alt="img"></p> <p>一个账号只能创建 3 个命名空间，需要谨慎创建。</p> <p>创建好后就是这样。</p> <p><img src="/TechnicalNotes/assets/img/kuangstudy7f2b0bf2-190f-4272-b2a3-857d1c65abc2.1c5ea63d.png" alt="img"></p> <blockquote><p>创建镜像仓库</p></blockquote> <p><img src="/TechnicalNotes/assets/img/kuangstudy33cd03cb-bfd7-4ca8-8d1e-59b87b1370dd.1cf433b7.png" alt="img"></p> <blockquote><p>点击下一步，创建本地仓库</p></blockquote> <p><img src="/TechnicalNotes/assets/img/kuangstudya3427a43-12f3-4d21-a579-6336f884034b.4ee41bb9.png" alt="img"></p> <p><img src="/TechnicalNotes/assets/img/kuangstudy8a8bbfee-29b9-46a0-9644-f8788e2804d0.0f1de278.png" alt="img"></p> <p>至此，我们就创建好了阿里云的镜像仓库，具体的操作步骤上图也写得非常清楚。</p> <blockquote><p>退出登录的账号</p></blockquote> <p>如果之前登录了 Docker Hub 账号或者其他阿里云账号，先退出账号。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs logs<span class="token punctuation">]</span><span class="token comment"># docker logout</span>
Removing login credentials <span class="token keyword">for</span> https://index.docker.io/v1/
</code></pre></div><blockquote><p>登录阿里云账号</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs logs<span class="token punctuation">]</span><span class="token comment"># docker login --username=用户名 registry.cn-hangzhou.aliyuncs.com</span>
Password: 
WARNING<span class="token operator">!</span> Your password will be stored unencrypted <span class="token keyword">in</span> /root/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/<span class="token comment">#credentials-store</span>
Login Succeeded
</code></pre></div><blockquote><p>设置镜像标签</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs logs<span class="token punctuation">]</span><span class="token comment"># docker tag d58be7785771 registry.cn-hangzhou.aliyuncs.com/asailing/qzs:1.0</span>
<span class="token punctuation">[</span>root@qzs logs<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY                                        TAG       IMAGE ID       CREATED        SIZE
asailing/centos                                   <span class="token number">1.0</span>       d58be7785771   <span class="token number">32</span> hours ago   323MB
registry.cn-hangzhou.aliyuncs.com/asailing/sail   <span class="token number">1.0</span>       d58be7785771   <span class="token number">32</span> hours ago   323MB
</code></pre></div><blockquote><p>提交镜像</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs logs<span class="token punctuation">]</span><span class="token comment"># docker push registry.cn-hangzhou.aliyuncs.com/asailing/qzs:1.0</span>
The push refers to repository <span class="token punctuation">[</span>registry.cn-hangzhou.aliyuncs.com/asailing/qzs<span class="token punctuation">]</span>
de70c523870b: Pushed 
909db45c4bc4: Pushed 
74ddd0ec08fa: Pushed 
<span class="token number">1.0</span>: digest: sha256:ecefaae6c5a2cab84693175ea3b18d0d0a7aa0160e33a0bf3eb4ab626b10f0f1 size: <span class="token number">953</span>
</code></pre></div><blockquote><p>查看提交的镜像</p></blockquote> <p><img src="/TechnicalNotes/assets/img/kuangstudyfb28acbd-766d-4818-b6df-2fb889ef1072.425104fe.png" alt="img"></p> <p>提交的镜像可以在这里查看。</p> <blockquote><p>拉取镜像</p></blockquote> <p>先删除本地镜像， 再拉取测试。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs logs<span class="token punctuation">]</span><span class="token comment"># docker rmi -f d58be7785771</span>
Untagged: asailing/centos:1.0
Untagged: asailing/centos@sha256:ecefaae6c5a2cab84693175ea3b18d0d0a7aa0160e33a0bf3eb4ab626b10f0f1
Untagged: registry.cn-hangzhou.aliyuncs.com/asailing/sail/centos:1.0
Untagged: registry.cn-hangzhou.aliyuncs.com/asailing/sail:1.0
Untagged: registry.cn-hangzhou.aliyuncs.com/asailing/sail@sha256:ecefaae6c5a2cab84693175ea3b18d0d0a7aa0160e33a0bf3eb4ab626b10f0f1
Deleted: sha256:d58be7785771bd95d8016fa5807a486d6c50e195879eddd88cb602172fc51ffe


<span class="token punctuation">[</span>root@qzs logs<span class="token punctuation">]</span><span class="token comment"># docker pull registry.cn-hangzhou.aliyuncs.com/asailing/sail:1.0</span>
<span class="token number">1.0</span>: Pulling from asailing/sail
a1d0c7532777: Already exists 
0594d57f8468: Already exists 
9c13f720f33e: Already exists 
Digest: sha256:ecefaae6c5a2cab84693175ea3b18d0d0a7aa0160e33a0bf3eb4ab626b10f0f1
Status: Downloaded newer image <span class="token keyword">for</span> registry.cn-hangzhou.aliyuncs.com/asailing/sail:1.0
registry.cn-hangzhou.aliyuncs.com/asailing/sail:1.0

<span class="token punctuation">[</span>root@qzs logs<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY                                        TAG       IMAGE ID       CREATED        SIZE
registry.cn-hangzhou.aliyuncs.com/asailing/sail   <span class="token number">1.0</span>       d58be7785771   <span class="token number">32</span> hours ago   323MB
</code></pre></div><blockquote><p>启动镜像</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@qzs logs<span class="token punctuation">]</span><span class="token comment"># docker run -it registry.cn-hangzhou.aliyuncs.com/asailing/sail:1.0</span>
<span class="token punctuation">[</span>root@c612099a94a2 local<span class="token punctuation">]</span><span class="token comment"># vim test.java</span>
<span class="token punctuation">[</span>root@c612099a94a2 local<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre></div><p><code>vim</code> 命令可以使用，说明提交镜像成功。</p> <h1 id="docker网络"><a href="#docker网络" class="header-anchor">#</a> Docker网络</h1> <h2 id="理解docker0"><a href="#理解docker0" class="header-anchor">#</a> 理解Docker0</h2> <p><img src="/TechnicalNotes/assets/img/地址.3fe08c22.png" alt="image-20220630164754130"></p> <blockquote><p>docker是如何处理容器访问网络的？</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#1.启动一个tomcat容器</span>
<span class="token function">docker</span> run -d -P --name tomcat01 tomcat
<span class="token comment">#2.查看容器的内部网络地址</span>
  <span class="token comment">#第一种docker exec -it tomact ip addr</span>
  <span class="token comment">#第二种 先进入容器 在使用ip addr</span>
root@8c32956f7370:/usr/local/tomcat<span class="token comment"># ip addr</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
<span class="token number">36</span>: eth0@if37: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue state UP group default
    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid <span class="token number">0</span>
    inet <span class="token number">172.17</span>.0.2/16 brd <span class="token number">172.17</span>.255.255 scope global eth0
       valid_lft forever preferred_lft forever
       
<span class="token comment">#3. ping 容器ip</span>
<span class="token punctuation">[</span>root@qzs /<span class="token punctuation">]</span><span class="token comment"># ping 172.17.0.2</span>
PING <span class="token number">172.17</span>.0.2 <span class="token punctuation">(</span><span class="token number">172.17</span>.0.2<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.2: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.986</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.2: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.102</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.2: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.070</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.2: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">4</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.062</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.2: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">5</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.076</span> ms
--- <span class="token number">172.17</span>.0.2 <span class="token function">ping</span> statistics ---
<span class="token number">5</span> packets transmitted, <span class="token number">5</span> received, <span class="token number">0</span>% packet loss, <span class="token function">time</span> 4001ms
rtt min/avg/max/mdev <span class="token operator">=</span> <span class="token number">0.062</span>/0.259/0.986/0.363 ms
 
</code></pre></div><blockquote><p>原理</p></blockquote> <p>1.每启动一个docker容器，docker就会给docker容器分配一个ip，我们只要安装了docker，就会有一个网卡docker0</p> <p>docker0是桥接模式，使用的技术是evth-pair技术</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#容器带来网卡，都是一对对的</span>
<span class="token comment">#evth-pair 就是一对的虚拟设备接口，它们都是成对出现的，一段连着协议，一段彼此相连</span>
<span class="token comment">#正因为有这个特性，evth-pair充当一个桥梁，连接各种虚拟网络设备的</span>
</code></pre></div><p>容器与容器之间可以相互ping通的</p> <p><img src="/TechnicalNotes/assets/img/容器之间通信.daa67473.png" alt=""></p> <p>​	结论：tomcat01 与 tomcat02是公用的一个路由器 docker0</p> <p>所有的容器不指定网络的情况下，都是docker0路由，docker会给我们容器分配一个默认的可用IP</p> <blockquote><p>小结</p></blockquote> <p>Docker使用的是Linux的桥接</p> <p><img src="/TechnicalNotes/assets/img/docker网络.feba9824.png" alt=""></p> <p>Docker中的所有网络接口都是虚拟的，虚拟的转发效率高、</p> <p>只要容器删除，对应的网桥就没了</p> <h2 id="link"><a href="#link" class="header-anchor">#</a> --link</h2> <blockquote><p>场景问题: 每次重新启动一个容器 容器ip变化，那么使用ip去访问就十分麻烦，有没有可以提供访问服务名来访问容器这样不管ip怎么变只要服务名不变就可以正常访问该容器</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 1. 通过服务名ping不通；如何解决？</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it tomcat02 <span class="token function">ping</span> tomcat01
ping: tomcat01: Name or <span class="token function">service</span> not known
<span class="token comment">#2.通过--link可以解决网络连接问题。</span>
<span class="token function">docker</span> run -d -P --name tomcat02 --link tomcat01 tomcat:7.0
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it tomcat03 <span class="token function">ping</span> tomcat02
<span class="token comment">#3.反向可以ping通吗？（不可以）</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it tomcat02 <span class="token function">ping</span> tomcat03
ping: tomcat03: Name or <span class="token function">service</span> not known

</code></pre></div><p>探究：docker network inspect networkID (docker network ls可以查看networkID)</p> <p>其实这个tomcat03就是在本地配置了tomcat02的配置</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#1.查看</span>
<span class="token builtin class-name">exec</span> -it tomcat03 <span class="token function">cat</span> /etc/hosts
<span class="token number">127.0</span>.0.1       localhost
::1     localhost ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
<span class="token number">172.17</span>.0.3      tomcat02 20398a94efa7
<span class="token number">172.17</span>.0.4      2393eecb870e
</code></pre></div><p>本质探究：—link 就是我们在hosts配置中增加了一个”172.17.0.3 tomcat02 20398a94efa7”
我们现在玩Docker已经不建议使用—link了！
自定义网络！不适用docker0！
docker0问题：他不支持容器名连接访问！</p> <h2 id="自定义网络"><a href="#自定义网络" class="header-anchor">#</a> 自定义网络</h2> <blockquote><h3 id="查看所有的docker网络"><a href="#查看所有的docker网络" class="header-anchor">#</a> 查看所有的docker网络</h3></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> network <span class="token function">ls</span>
</code></pre></div><blockquote><p><strong>网络模式</strong></p></blockquote> <p>bridge：桥接 docker（默认，自己创建也使用bridge桥接模式）
none：不配置网络
host：和主机共享网络
container：容器网络连通！（用的少！局限很大）</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 我们直接启动的命令--net bridge（这个就是我们的docker0）；默认带上这个参数的，以下两种启动方式效果一致。</span>
<span class="token function">docker</span> run -d -P --name tomcat01 tomcat
<span class="token function">docker</span> run -d -P --name tomcato1 --het bridge tomcat
</code></pre></div><blockquote><p>创建自定义网络</p></blockquote> <ul><li>docker network creat
<ul><li><code>-d</code>：网络模式</li> <li><code>--subnet</code>：子网</li> <li><code>--gateway</code>：网关</li></ul></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># docker0特点：默认，域名不能访问，--1ink可以打通连接！</span>
<span class="token comment"># 我们可以自定义一个网络！</span>
<span class="token comment"># docker network</span>
<span class="token function">docker</span> network create --driver bridge --subnet <span class="token number">192.168</span>.0.0/16 --gateway <span class="token number">192.168</span>.0.1 mynet
<span class="token comment"># 查看创建的网络</span>
<span class="token function">docker</span> network <span class="token function">ls</span>
NETWORK ID     NAME      DRIVER    SCOPE
7254ffccbdf5   bridge    bridge    <span class="token builtin class-name">local</span>
45610891738f   <span class="token function">host</span>      <span class="token function">host</span>      <span class="token builtin class-name">local</span>
266acd66473c   mynet     bridge    <span class="token builtin class-name">local</span>
7795cbc2686c   none      null      <span class="token builtin class-name">local</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> network inspect 801fbbe1b38c
<span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;mynet&quot;</span>,
        <span class="token string">&quot;Id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;801fbbe1b38c81b12ce90aa9139561b5843dca64b4b17718b6e2622369f9be67&quot;</span>,
        <span class="token string">&quot;Created&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2021-12-30T17:39:43.100705632+08:00&quot;</span>,
        <span class="token string">&quot;Scope&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>,
        <span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;bridge&quot;</span>,
        <span class="token string">&quot;EnableIPv6&quot;</span><span class="token builtin class-name">:</span> false,
        <span class="token string">&quot;IPAM&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;default&quot;</span>,
            <span class="token string">&quot;Options&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
            <span class="token string">&quot;Config&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token string">&quot;Subnet&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;192.168.0.0/16&quot;</span>,
                    <span class="token string">&quot;Gateway&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;192.168.0.1&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>,
        <span class="token string">&quot;Internal&quot;</span><span class="token builtin class-name">:</span> false,
        <span class="token string">&quot;Attachable&quot;</span><span class="token builtin class-name">:</span> false,
        <span class="token string">&quot;Ingress&quot;</span><span class="token builtin class-name">:</span> false,
        <span class="token string">&quot;ConfigFrom&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;Network&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
        <span class="token punctuation">}</span>,
        <span class="token string">&quot;ConfigOnly&quot;</span><span class="token builtin class-name">:</span> false,
        <span class="token string">&quot;Containers&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
        <span class="token string">&quot;Options&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
        <span class="token string">&quot;Labels&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>



</code></pre></div><blockquote><p>以下配置可以看出，自定义网络创建完成。</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token string">&quot;Config&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">&quot;Subnet&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;192.168.0.0/16&quot;</span>,
        <span class="token string">&quot;Gateway&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;192.168.0.1&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p>启动容器</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#启动两个容器测试：</span>
<span class="token function">docker</span> run -d -P --name tomcat-net-01 --net mynet tomcat:7.0
<span class="token function">docker</span> run -d -P --name tomcat-net-02 --net mynet tomcat:7.0
</code></pre></div><p>连接测试</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 不使用--link，ping名字也可以ping通。tomcat-net-01 ping tomcat-net-02可以ping通</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it tomcat-net-01 <span class="token function">ping</span> tomcat-net-02
PING tomcat-net-02 <span class="token punctuation">(</span><span class="token number">192.168</span>.0.3<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from tomcat-net-02.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.3<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.067</span> ms
<span class="token number">64</span> bytes from tomcat-net-02.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.3<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.056</span> ms
<span class="token comment"># 不使用--link，ping名字也可以ping通。tomcat-net-02 ping tomcat-net-01可以ping通</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it tomcat-net-02 <span class="token function">ping</span> tomcat-net-01
PING tomcat-net-01 <span class="token punctuation">(</span><span class="token number">192.168</span>.0.2<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from tomcat-net-01.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.2<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.050</span> ms
<span class="token number">64</span> bytes from tomcat-net-01.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.2<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.056</span> ms
</code></pre></div><p>能够连通说明不同容器处于同一网络下。</p> <blockquote><p>这种方式可以实现不同集群使用不同的网络，保证集群网络的安全。</p></blockquote> <p>我们自定义的网络docker都已经帮我们维护好了对应的关系，<strong>推荐我们平时这样使用网络</strong>！
redis -不同的集群使用不同的网络，保证集群是安全和健康的
mysql -不同的集群使用不同的网络，保证集群是安全和健康的</p> <h2 id="网络连通"><a href="#网络连通" class="header-anchor">#</a> 网络连通</h2> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># tomcat01在docker0网络下，tomcat-net-01在mynet网络下；</span>
<span class="token comment"># tomcat01 ping tomcat-net-01是ping不通的</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it tomcat01 <span class="token function">ping</span> tomcat-net-01
ping: tomcat-net-01: Name or <span class="token function">service</span> not known
</code></pre></div><p><img src="/TechnicalNotes/assets/img/不同网络之间容器不能联通.971a7bf4.jpg" alt=""></p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token comment">#1.查看docker 网络</span>
docker network <span class="token operator">--</span>help
Usage:  docker network COMMAND
Manage networks
Commands:
  connect     Connect a container to a network
  create      Create a network
  disconnect  Disconnect a container <span class="token keyword">from</span> a network
  inspect     Display detailed information on one or more networks
  <span class="token function">ls</span>          List networks
  prune       Remove all unused networks
  <span class="token function">rm</span>          Remove one or more networks
Run <span class="token string">'docker network COMMAND --help'</span> <span class="token keyword">for</span> more information on a command<span class="token punctuation">.</span>

</code></pre></div><p>使用<code>docker network connect</code>实现一个容器链接到另一个网段。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#1.建立连接</span>
<span class="token function">docker</span> network connect mynet tomcat02-net
<span class="token comment">#2.查看docker网络</span>
<span class="token function">docker</span> network <span class="token function">ls</span>
NETWORK ID     NAME      DRIVER    SCOPE
f3eeb014197a   bridge    bridge    <span class="token builtin class-name">local</span>
28d77e958643   <span class="token function">host</span>      <span class="token function">host</span>      <span class="token builtin class-name">local</span>
801fbbe1b38c   mynet     bridge    <span class="token builtin class-name">local</span>
c3ff850e96f0   none      null      <span class="token builtin class-name">local</span>
<span class="token comment">#3.查看 容器所在网络的网络配置</span>
<span class="token function">docker</span> network inspect 801fbbe1b38c
<span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;mynet&quot;</span>,
        <span class="token string">&quot;Id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;801fbbe1b38c81b12ce90aa9139561b5843dca64b4b17718b6e2622369f9be67&quot;</span>,
        <span class="token string">&quot;Created&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2021-12-30T17:39:43.100705632+08:00&quot;</span>,
        <span class="token string">&quot;Scope&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>,
        <span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;bridge&quot;</span>,
        <span class="token string">&quot;EnableIPv6&quot;</span><span class="token builtin class-name">:</span> false,
        <span class="token string">&quot;IPAM&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;default&quot;</span>,
            <span class="token string">&quot;Options&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
            <span class="token string">&quot;Config&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token string">&quot;Subnet&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;192.168.0.0/16&quot;</span>,
                    <span class="token string">&quot;Gateway&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;192.168.0.1&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>,
        <span class="token string">&quot;Internal&quot;</span><span class="token builtin class-name">:</span> false,
        <span class="token string">&quot;Attachable&quot;</span><span class="token builtin class-name">:</span> false,
        <span class="token string">&quot;Ingress&quot;</span><span class="token builtin class-name">:</span> false,
        <span class="token string">&quot;ConfigFrom&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;Network&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
        <span class="token punctuation">}</span>,
        <span class="token string">&quot;ConfigOnly&quot;</span><span class="token builtin class-name">:</span> false,
        <span class="token string">&quot;Containers&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;5a02cd4172daccc5073907ee6b063560687db5ffdd5041b18fd3ff1055a8984c&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;tomcat02-net&quot;</span>,
                <span class="token string">&quot;EndpointID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;e6503138bcb91a7693576e324df75d1dff594f1c5aa3e08397802c38133eb0e9&quot;</span>,
                <span class="token string">&quot;MacAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;02:42:c0:a8:00:05&quot;</span>,
                <span class="token string">&quot;IPv4Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;192.168.0.5/16&quot;</span>,
                <span class="token string">&quot;IPv6Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token string">&quot;Options&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
        <span class="token string">&quot;Labels&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p>这样也可以实现容器链接到自定义网络。</p> <blockquote><p>查看容器详情</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#1.查看运行中的容器id</span>
<span class="token function">docker</span> <span class="token function">ps</span>
CONTAINER ID   IMAGE     COMMAND             CREATED             STATUS             PORTS                     NAMES
5a02cd4172da   tomcat    <span class="token string">&quot;catalina.sh run&quot;</span>   <span class="token number">5</span> minutes ago       Up <span class="token number">5</span> minutes       <span class="token number">0.0</span>.0.0:49159-<span class="token operator">&gt;</span><span class="token number">8080</span>/tcp   tomcat02-net

<span class="token comment">#2.查看容器的网络配置</span>
<span class="token function">docker</span> inspect 5a02cd4172da
</code></pre></div><p><img src="/TechnicalNotes/assets/img/容器的网络配置.9506e84c.png" alt=""></p> <blockquote><p>测试连接</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it tomcat02 <span class="token function">ping</span> tomcat02-net
PING tomcat02-net <span class="token punctuation">(</span><span class="token number">192.168</span>.0.2<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from tomcat02-net.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.2<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.121</span> ms
<span class="token number">64</span> bytes from tomcat02-net.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.2<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.064</span> ms
^C
--- tomcat02-net <span class="token function">ping</span> statistics ---
</code></pre></div><p>网络连通成功。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新:</span> <span class="time">2024/12/16 10:54:07</span></div></footer> <!----> </main></div> <div class="footer" data-v-34d4abe6><div id="footer-info" data-v-34d4abe6><div class="footer-left" data-v-34d4abe6>
      © 2020-2024
      <!----></div> <div class="footer-right" data-v-34d4abe6>Theme:<a href="https://github.com/JoeyBling/vuepress-theme-yilia-plus" target="_blank">vuepress-theme-yilia-plus</a> by Litten</div></div> <div class="busuanzi" data-v-34d4abe6><span id="busuanzi_container_site_pv" style="display:none">
    本站总访问量
    <span id="busuanzi_value_site_pv"></span>次
    <span class="post-meta-divider">|</span></span> <span id="busuanzi_container_site_uv" style="display:none">
    本站访客数
    <span id="busuanzi_value_site_uv"></span>人
  </span></div></div></main><div class="global-ui"><!----><!----></div></div>
    <script src="/TechnicalNotes/assets/js/app.c00b0a4a.js" defer></script><script src="/TechnicalNotes/assets/js/3.ede93df9.js" defer></script><script src="/TechnicalNotes/assets/js/4.d93f2a77.js" defer></script><script src="/TechnicalNotes/assets/js/15.024d8240.js" defer></script>
  </body>
</html>
